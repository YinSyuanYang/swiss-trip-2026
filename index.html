<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>ğŸ‡¨ğŸ‡­ ç‘å£«ä¹‹æ—… 2026</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‡¨ğŸ‡­</text></svg>">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif; background: linear-gradient(to bottom, #fef2f2, #fff); min-height: 100vh; }
    .header { background: linear-gradient(to right, #dc2626, #b91c1c); color: #fff; padding: 20px; border-radius: 0 0 24px 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .header h1 { font-size: 1.25rem; display: flex; align-items: center; gap: 8px; }
    .header p { color: #fecaca; font-size: 0.875rem; margin-top: 4px; }
    .tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    .tag { background: rgba(255,255,255,0.2); padding: 2px 10px; border-radius: 20px; font-size: 0.75rem; }
    .tabs { display: flex; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
    .tab { flex: 1; padding: 12px 8px; border: none; background: none; cursor: pointer; font-size: 0.75rem; color: #6b7280; display: flex; flex-direction: column; align-items: center; gap: 4px; transition: all 0.2s; }
    .tab.active { color: #dc2626; border-bottom: 2px solid #dc2626; }
    .tab-icon { font-size: 1.25rem; }
    .content { padding: 16px; padding-bottom: 80px; max-width: 500px; margin: 0 auto; }
    .card { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 12px; overflow: hidden; }
    .card.highlight { box-shadow: 0 0 0 2px #ef4444, 0 2px 8px rgba(0,0,0,0.08); }
    .card.family { background: #fffbeb; }
    .day-header { width: 100%; padding: 16px; display: flex; align-items: center; justify-content: space-between; border: none; background: none; cursor: pointer; text-align: left; }
    .day-header:hover { background: #f9fafb; }
    .day-left { display: flex; align-items: center; gap: 12px; }
    .day-icon { font-size: 1.75rem; }
    .day-date { font-size: 0.75rem; color: #6b7280; }
    .day-title { font-weight: 600; color: #1f2937; }
    .day-loc { font-size: 0.75rem; color: #dc2626; }
    .day-right { display: flex; align-items: center; gap: 8px; }
    .badge { font-size: 0.625rem; padding: 2px 8px; border-radius: 20px; }
    .badge-family { background: #fde68a; color: #92400e; }
    .badge-highlight { background: #fee2e2; color: #dc2626; }
    .arrow { color: #9ca3af; font-size: 0.875rem; }
    .day-content { padding: 0 16px 16px; border-top: 1px solid #f3f4f6; display: none; }
    .day-content.open { display: block; }
    .hotel-box { margin-top: 12px; padding: 12px; background: #eff6ff; border-radius: 8px; display: flex; align-items: center; gap: 8px; font-size: 0.875rem; }
    .schedule { margin-top: 12px; }
    .schedule-item { display: flex; gap: 12px; padding: 8px 0; font-size: 0.875rem; }
    .schedule-time { width: 48px; color: #dc2626; font-family: monospace; font-weight: 500; flex-shrink: 0; }
    .schedule-activity { flex: 1; color: #374151; }
    .schedule-duration { font-size: 0.75rem; color: #9ca3af; margin-top: 2px; }
    .map-btn { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 12px; background: #16a34a; color: #fff; border: none; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; margin-top: 16px; text-decoration: none; }
    .map-btn:hover { background: #15803d; }
    .section-title { font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .route-item { display: flex; align-items: center; gap: 8px; padding: 8px 0; font-size: 0.875rem; }
    .route-dot { width: 12px; height: 12px; background: #ef4444; border-radius: 50%; }
    .price-row { display: flex; justify-content: space-between; padding: 10px 12px; font-size: 0.875rem; border-radius: 8px; margin-bottom: 8px; }
    .price-row.recommended { background: #f0fdf4; }
    .price-row.normal { background: #f9fafb; }
    .price-value { font-weight: 600; }
    .price-value.green { color: #16a34a; }
    .tip-box { background: #fffbeb; padding: 16px; border-radius: 12px; }
    .tip-box h3 { font-size: 0.875rem; margin-bottom: 8px; }
    .tip-box li { font-size: 0.875rem; color: #374151; margin-left: 16px; margin-bottom: 4px; }
    .budget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 8px; }
    .rate-badge { font-size: 0.75rem; background: #f3f4f6; padding: 6px 12px; border-radius: 20px; cursor: pointer; display: flex; align-items: center; gap: 4px; }
    .rate-badge:hover { background: #e5e7eb; }
    .rate-input { width: 50px; padding: 4px 6px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.75rem; text-align: center; }
    .budget-cat { font-weight: 500; color: #374151; margin: 16px 0 8px; }
    .budget-row { display: flex; align-items: center; padding: 10px 0 10px 12px; border-bottom: 1px solid #f3f4f6; font-size: 0.875rem; gap: 8px; }
    .budget-row:hover { background: #f9fafb; }
    .budget-item { flex: 1; color: #4b5563; min-width: 0; }
    .budget-item-name { word-break: break-word; }
    .budget-item-note { font-size: 0.75rem; color: #9ca3af; margin-top: 2px; }
    .budget-chf { width: 65px; text-align: right; flex-shrink: 0; }
    .budget-twd { width: 80px; text-align: right; color: #9ca3af; flex-shrink: 0; }
    .budget-actions { display: flex; gap: 4px; opacity: 0; transition: opacity 0.2s; }
    .budget-row:hover .budget-actions { opacity: 1; }
    .btn-icon { width: 28px; height: 28px; border: none; background: none; cursor: pointer; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; }
    .btn-icon:hover { background: #e5e7eb; }
    .btn-icon.edit { color: #3b82f6; }
    .btn-icon.delete { color: #ef4444; }
    .budget-total { border-top: 2px solid #fecaca; padding-top: 16px; margin-top: 16px; display: flex; justify-content: space-between; align-items: center; }
    .budget-total-label { font-weight: 600; }
    .budget-total-value { text-align: right; }
    .budget-total-chf { font-size: 1.25rem; font-weight: 700; color: #dc2626; }
    .budget-total-twd { font-size: 0.875rem; color: #6b7280; }
    .info-box { background: #eff6ff; padding: 16px; border-radius: 12px; font-size: 0.875rem; color: #1e40af; margin-top: 16px; }
    .add-btn { width: 100%; padding: 14px; background: #3b82f6; color: #fff; border: none; border-radius: 12px; font-size: 0.875rem; font-weight: 500; cursor: pointer; margin-top: 12px; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .add-btn:hover { background: #2563eb; }
    .add-btn.purple { background: #8b5cf6; }
    .add-btn.purple:hover { background: #7c3aed; }
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 200; padding: 16px; }
    .modal.hidden { display: none; }
    .modal-content { background: #fff; border-radius: 16px; padding: 20px; width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .modal-title { font-weight: 600; font-size: 1.125rem; }
    .modal-close { width: 32px; height: 32px; border: none; background: #f3f4f6; border-radius: 8px; cursor: pointer; font-size: 1.25rem; display: flex; align-items: center; justify-content: center; }
    .modal-close:hover { background: #e5e7eb; }
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 0.75rem; color: #6b7280; margin-bottom: 6px; }
    .form-input, .form-select { width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 0.875rem; }
    .form-input:focus, .form-select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
    .form-hint { font-size: 0.75rem; color: #9ca3af; margin-top: 4px; }
    .form-btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; }
    .form-btn.primary { background: #22c55e; color: #fff; }
    .form-btn.primary:hover { background: #16a34a; }
    .form-btn.primary:disabled { background: #d1d5db; cursor: not-allowed; }
    .form-btn.secondary { background: #e5e7eb; color: #374151; margin-top: 8px; }
    .form-btn.secondary:hover { background: #d1d5db; }
    .packing-header { background: #fff; border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); position: sticky; top: 52px; z-index: 50; margin-bottom: 16px; }
    .packing-title { display: flex; justify-content: space-between; align-items: center; }
    .packing-count { font-size: 1.125rem; font-weight: 700; }
    .packing-count.done { color: #16a34a; }
    .packing-count.pending { color: #dc2626; }
    .packing-subtitle { font-size: 0.75rem; color: #6b7280; }
    .progress-bar { height: 12px; background: #e5e7eb; border-radius: 6px; margin-top: 12px; overflow: hidden; }
    .progress-fill { height: 100%; background: #22c55e; transition: width 0.3s; }
    .packing-btns { display: flex; gap: 8px; margin-bottom: 16px; }
    .packing-btns .add-btn { flex: 1; margin: 0; padding: 10px; font-size: 0.8rem; }
    .cat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .cat-title { font-weight: 600; }
    .cat-actions { display: flex; align-items: center; gap: 8px; }
    .cat-count { font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; background: #f3f4f6; }
    .cat-count.done { background: #dcfce7; color: #16a34a; }
    .check-item { display: flex; align-items: center; gap: 12px; padding: 10px 8px; border-radius: 8px; cursor: pointer; transition: background 0.2s; }
    .check-item:hover { background: #f9fafb; }
    .check-item.checked { background: #f0fdf4; }
    .checkbox { width: 24px; height: 24px; border: 2px solid #d1d5db; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
    .check-item.checked .checkbox { background: #22c55e; border-color: #22c55e; color: #fff; }
    .check-label { font-size: 0.875rem; color: #374151; flex: 1; }
    .check-item.checked .check-label { color: #9ca3af; text-decoration: line-through; }
    .check-actions { display: flex; gap: 2px; opacity: 0; transition: opacity 0.2s; }
    .check-item:hover .check-actions { opacity: 1; }
    .reset-btn { width: 100%; padding: 14px; background: #e5e7eb; color: #4b5563; border: none; border-radius: 12px; font-size: 0.875rem; font-weight: 500; cursor: pointer; margin-top: 16px; }
    .reset-btn:hover { background: #d1d5db; }
    .footer { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; border-top: 1px solid #e5e7eb; padding: 12px; text-align: center; font-size: 0.75rem; color: #6b7280; }
    .hidden { display: none !important; }
    @media (max-width: 400px) {
      .budget-twd { display: none; }
      .budget-actions { opacity: 1; }
      .check-actions { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1><span>ğŸ‡¨ğŸ‡­</span> ç‘å£«ä¹‹æ—… 2026</h1>
    <p>2/7 - 2/20 ï½œ14å¤©</p>
    <div class="tags">
      <span class="tag">å°‘å¥³å³°</span>
      <span class="tag">é¦¬ç‰¹æ´ªå³°</span>
      <span class="tag">å†°å·åˆ—è»Š</span>
      <span class="tag">åˆ—æ”¯æ•¦å£«ç™»</span>
    </div>
  </div>

  <div class="tabs">
    <button class="tab active" data-tab="itinerary"><span class="tab-icon">ğŸ“…</span>è¡Œç¨‹</button>
    <button class="tab" data-tab="glacier"><span class="tab-icon">ğŸš‚</span>å†°å·åˆ—è»Š</button>
    <button class="tab" data-tab="budget"><span class="tab-icon">ğŸ’°</span>é ç®—</button>
    <button class="tab" data-tab="packing"><span class="tab-icon">ğŸ§³</span>æ‰“åŒ…</button>
  </div>

  <div class="content">
    <div id="itinerary-tab"></div>
    <div id="glacier-tab" class="hidden"></div>
    <div id="budget-tab" class="hidden"></div>
    <div id="packing-tab" class="hidden"></div>
  </div>

  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title" id="modal-title">æ–°å¢</span>
        <button class="modal-close" onclick="closeModal()">Ã—</button>
      </div>
      <div id="modal-body"></div>
    </div>
  </div>

  <div class="footer">ğŸ‡¨ğŸ‡­ ç‘å£«ä¹‹æ—… 2026 ï½œæƒ…äººç¯€å¿«æ¨‚ â¤ï¸</div>

  <script>
    const DEFAULT_DATA = {
      itinerary: [
        { date: '2/7 (å…­)', title: 'EvaæŠµé”è˜‡é»ä¸–', icon: 'âœˆï¸', loc: 'è˜‡é»ä¸–', schedule: [
          { t: '12:00', a: 'âœˆï¸ å¾è‹±åœ‹å‡ºç™¼', d: '1h45m' }, { t: '15:00', a: 'æŠµé”è˜‡é»ä¸–æ©Ÿå ´', d: '-' },
          { t: '15:30', a: 'æ­ç«è»Šè‡³å¸‚å€', d: '15m' }, { t: '16:00', a: 'å…¥ä½é…’åº—', d: '1h' },
          { t: '17:00', a: 'ç­éœå¤«å¤§è¡—è³¼ç‰©', d: '1.5h' }, { t: '18:30', a: 'å¤§æ•™å ‚ GrossmÃ¼nster', d: '30m' },
          { t: '19:00', a: 'æ—ç™»éœå¤«å±±ä¸˜', d: '30m' }, { t: '20:00', a: 'è€åŸæ™šé¤', d: '1.5h' }
        ], map: ['Zurich Airport', 'Zurich HB', 'Bahnhofstrasse Zurich', 'Grossmunster Zurich'] },
        { date: '2/8 (æ—¥)', title: 'å®¶äººæŠµé”ãƒ»æœƒåˆï¼', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', loc: 'è˜‡é»ä¸–', hl: true, schedule: [
          { t: '07:30', a: 'ğŸ›¬ å®¶äººæŠµé”è˜‡é»ä¸–æ©Ÿå ´', d: '-' }, { t: '08:30', a: 'æ¥æ©Ÿãƒ»æ—©é¤', d: '1.5h' },
          { t: '10:00', a: 'ç«è»Šè‡³å¸‚å€ãƒ»å¯„æ”¾è¡Œæ', d: '30m' }, { t: '10:30', a: 'é…’åº—ä¼‘æ¯èª¿æ™‚å·®', d: '2h' },
          { t: '13:00', a: 'åˆé¤ Zeughauskeller', d: '1h' }, { t: '14:30', a: 'è˜‡é»ä¸–æ¹–ç•”æ•£æ­¥', d: '1.5h' },
          { t: '16:00', a: 'SprÃ¼ngli å·§å…‹åŠ›åº—', d: '30m' }, { t: '17:00', a: 'è€åŸæ¼«æ­¥', d: '2h' }
        ], map: ['Zurich Airport', 'Zurich HB', 'Zeughauskeller Zurich', 'Lake Zurich'] },
        { date: '2/9 (ä¸€)', title: 'ğŸ‡±ğŸ‡® åˆ—æ”¯æ•¦å£«ç™»', icon: 'ğŸ°', loc: 'ç“¦æœèŒ²', schedule: [
          { t: '08:30', a: 'ğŸš‚ è˜‡é»ä¸–å‡ºç™¼', d: '1h' }, { t: '09:30', a: 'Sargans è½‰è»Š', d: '15m' },
          { t: '10:00', a: 'ğŸšŒ æŠµé”ç“¦æœèŒ²', d: '-' }, { t: '10:30', a: 'è­·ç…§è“‹ç´€å¿µç«  CHF3', d: '30m' },
          { t: '11:00', a: 'ç“¦æœèŒ²åŸå ¡(å¤–è§€)', d: '1h' }, { t: '12:00', a: 'åˆé¤', d: '1h' },
          { t: '13:30', a: 'è—è¡“åšç‰©é¤¨', d: '1.5h' }, { t: '15:00', a: 'ç‹å®¤é…’èŠå“é…’', d: '1h' },
          { t: '17:00', a: 'ğŸšŒğŸš‚ è¿”å›è˜‡é»ä¸–', d: '1.5h' }
        ], map: ['Zurich HB', 'Sargans Station', 'Vaduz Liechtenstein', 'Vaduz Castle'] },
        { date: '2/10 (äºŒ)', title: 'ç‰æ£®', icon: 'ğŸ¦', loc: 'ç‰æ£®', schedule: [
          { t: '09:00', a: 'ğŸš‚ è˜‡é»ä¸–â†’ç‰æ£®', d: '45m' }, { t: '10:00', a: 'ç…å­ç´€å¿µç¢‘', d: '30m' },
          { t: '10:45', a: 'å†°æ²³å…¬åœ’', d: '1h' }, { t: '12:00', a: 'åˆé¤', d: '1h' },
          { t: '13:30', a: 'å¡è²çˆ¾æ©‹', d: '30m' }, { t: '14:00', a: 'è€åŸæ¼«æ­¥', d: '2h' },
          { t: '16:00', a: 'å¤©éµå»£å ´è³¼ç‰©', d: '1.5h' }, { t: '18:00', a: 'æ¹–ç•”æ™šé¤', d: '2h' }
        ], map: ['Zurich HB', 'Luzern Station', 'Lion Monument Luzern', 'Chapel Bridge Luzern'] },
        { date: '2/11 (ä¸‰)', title: 'å‰å¾€å°‘å¥³å³°åœ°å€', icon: 'ğŸ”ï¸', loc: 'æ ¼æ—å¾·ç“¦', schedule: [
          { t: '09:00', a: 'ğŸš‚ ç‰æ£®â†’å› ç‰¹æ‹‰è‚¯ (é»ƒé‡‘åˆ—è»Š)', d: '2h' }, { t: '11:00', a: 'å› ç‰¹æ‹‰è‚¯åˆé¤', d: '1h' },
          { t: '12:30', a: 'ğŸš‚ å› ç‰¹æ‹‰è‚¯â†’æ ¼æ—å¾·ç“¦', d: '35m' }, { t: '13:30', a: 'å…¥ä½é…’åº—', d: '1h' },
          { t: '15:00', a: 'å°é®æ•£æ­¥ãƒ»è‰¾æ ¼å³°è§€æ™¯', d: '3h' }, { t: '19:00', a: 'ç‘å£«å‚³çµ±æ™šé¤', d: '2h' }
        ], map: ['Luzern Station', 'Interlaken Ost', 'Grindelwald'] },
        { date: '2/12 (å››)', title: 'â­ å°‘å¥³å³° Top of Europe', icon: 'ğŸ—»', loc: 'å°‘å¥³å³°', hl: true, schedule: [
          { t: '07:30', a: 'æ—©é¤', d: '30m' }, { t: '08:30', a: 'ğŸš¡ Eiger Express çºœè»Š', d: '15m' },
          { t: '09:00', a: 'ğŸš‚ å°‘å¥³å³°éµè·¯', d: '30m' }, { t: '09:30', a: 'æŠµé”å°‘å¥³å³°ç«™ 3,454m', d: '-' },
          { t: '10:00', a: 'æ–¯èŠ¬å…‹æ–¯è§€æ™¯å°', d: '1h' }, { t: '11:00', a: 'å†°å®® Ice Palace', d: '45m' },
          { t: '12:00', a: 'å±±é ‚åˆé¤', d: '1h' }, { t: '13:00', a: 'é›ªåœ°æ´»å‹•/æ‹ç…§', d: '2h' },
          { t: '15:30', a: 'ä¸‹å±±è¿”å›æ ¼æ—å¾·ç“¦', d: '1h' }
        ], map: ['Grindelwald Terminal', 'Eigergletscher', 'Jungfraujoch'] },
        { date: '2/13 (äº”)', title: 'å‰å¾€è–è«é‡ŒèŒ²', icon: 'ğŸ¿', loc: 'è–è«é‡ŒèŒ²', schedule: [
          { t: '08:00', a: 'æ—©é¤ãƒ»é€€æˆ¿', d: '1h' }, { t: '09:00', a: 'ğŸš‚ æ ¼æ—å¾·ç“¦â†’è–è«é‡ŒèŒ²', d: '4h' },
          { t: '13:00', a: 'æŠµé”è–è«é‡ŒèŒ²ãƒ»å…¥ä½', d: '1h' }, { t: '14:00', a: 'åˆé¤', d: '1h' },
          { t: '15:00', a: 'è–è«é‡ŒèŒ²æ¹–æ•£æ­¥', d: '1.5h' }, { t: '17:00', a: 'å°é®è³¼ç‰© Via Serlas', d: '1.5h' },
          { t: '19:00', a: 'æ™šé¤ãƒ»æ—©ç¡', d: '2h' }
        ], map: ['Grindelwald', 'St Moritz', 'St Moritz Lake'] },
        { date: '2/14 (å…­)', title: 'â¤ï¸ å†°å·åˆ—è»Š æƒ…äººç¯€', icon: 'ğŸš‚', loc: 'é‡‡çˆ¾é¦¬ç‰¹', hl: true, schedule: [
          { t: '07:00', a: 'æ—©é¤ãƒ»é€€æˆ¿', d: '1h' }, { t: '08:38', a: 'ğŸš‚ å†°å·åˆ—è»Šå‡ºç™¼ï¼', d: '8h30m' },
          { t: '10:00', a: 'ğŸ“¸ è˜­å¾·ç“¦ç‘Ÿé«˜æ¶æ©‹', d: '-' }, { t: '12:00', a: 'ğŸ½ï¸ è»Šä¸Šä¸‰é“å¼åˆé¤', d: '1.5h' },
          { t: '14:00', a: 'â›°ï¸ ä¸Šé˜¿çˆ¾å‘æ–¯å±±å£ 2,033m', d: '-' }, { t: '17:07', a: 'æŠµé”é‡‡çˆ¾é¦¬ç‰¹', d: '-' },
          { t: '17:30', a: 'å…¥ä½é…’åº—', d: '30m' }, { t: '18:00', a: 'å°é®æ¼«æ­¥', d: '1h' },
          { t: '19:30', a: 'â¤ï¸ æƒ…äººç¯€æ™šé¤', d: '2h' }
        ], map: ['St Moritz Station', 'Zermatt'] },
        { date: '2/15 (æ—¥)', title: 'é¦¬ç‰¹æ´ªå³°', icon: 'ğŸ”ï¸', loc: 'é‡‡çˆ¾é¦¬ç‰¹', schedule: [
          { t: '08:00', a: 'æ—©é¤', d: '1h' }, { t: '09:00', a: 'ğŸš‚ Gornergrat ç™»å±±éµè·¯', d: '33m' },
          { t: '09:45', a: 'æŠµé” Gornergrat 3,089m', d: '-' }, { t: '10:00', a: 'é¦¬ç‰¹æ´ªå³°è§€æ™¯', d: '2h' },
          { t: '12:00', a: 'å±±é ‚åˆé¤', d: '1h' }, { t: '13:30', a: 'ä¸‹å±±ãƒ»ä¸­é€”ç«™å¥è¡Œ', d: '2h' },
          { t: '16:00', a: 'è¿”å›é‡‡çˆ¾é¦¬ç‰¹', d: '-' }, { t: '17:00', a: 'å°é®è³¼ç‰©', d: '2h' }
        ], map: ['Zermatt', 'Gornergrat Bahn Zermatt', 'Gornergrat'] },
        { date: '2/16 (ä¸€)', title: 'æ—¥å…§ç“¦', icon: 'â›²', loc: 'æ—¥å…§ç“¦', schedule: [
          { t: '08:00', a: 'æ—©é¤ãƒ»é€€æˆ¿', d: '1h' }, { t: '09:15', a: 'ğŸš‚ é‡‡çˆ¾é¦¬ç‰¹â†’æ—¥å…§ç“¦', d: '3h45m' },
          { t: '13:00', a: 'æŠµé”æ—¥å…§ç“¦ãƒ»å…¥ä½', d: '1h' }, { t: '14:00', a: 'åˆé¤', d: '1h' },
          { t: '15:00', a: 'å¤§å™´æ³‰ Jet d\'Eau', d: '30m' }, { t: '15:45', a: 'èŠ±é˜', d: '15m' },
          { t: '16:00', a: 'è€åŸãƒ»è–å½¼å¾—å¤§æ•™å ‚', d: '1.5h' }, { t: '17:30', a: 'è¯åˆåœ‹è¬åœ‹å®®', d: '30m' },
          { t: '19:00', a: 'æ¹–ç•”æ™šé¤', d: '2h' }
        ], map: ['Geneva Cornavin', 'Jet dEau Geneva', 'Geneva Old Town', 'Palais des Nations Geneva'] },
        { date: '2/17 (äºŒ)', title: 'Evaè¿”å›è‹±åœ‹', icon: 'âœˆï¸', loc: 'æ—¥å…§ç“¦', schedule: [
          { t: '08:00', a: 'æ—©é¤ãƒ»Evaå‘Šåˆ¥', d: '1h' }, { t: '09:30', a: 'âœˆï¸ Evaå‰å¾€æ©Ÿå ´', d: '30m' },
          { t: '12:00', a: 'âœˆï¸ Evaé£›å›è‹±åœ‹', d: '1h45m' }, { t: '---', a: 'â”€â”€â”€ å®¶äººè¡Œç¨‹ â”€â”€â”€', d: '-' },
          { t: '10:00', a: 'æ—¥å…§ç“¦æ¹–éŠèˆ¹', d: '1.5h' }, { t: '12:00', a: 'åˆé¤', d: '1h' },
          { t: '14:00', a: 'å¥§æ—åŒ¹å…‹åšç‰©é¤¨', d: '2h' }, { t: '17:00', a: 'è¿”å›æ—¥å…§ç“¦', d: '1h' }
        ], map: ['Geneva Airport', 'Lake Geneva', 'Olympic Museum Lausanne'] },
        { date: '2/18 (ä¸‰)', title: 'å®¶äººè¿”å›è˜‡é»ä¸–', icon: 'ğŸš‚', loc: 'è˜‡é»ä¸–', fam: true, schedule: [
          { t: '09:00', a: 'æ—©é¤ãƒ»é€€æˆ¿', d: '1h' }, { t: '10:00', a: 'ğŸš‚ æ—¥å…§ç“¦â†’è˜‡é»ä¸–', d: '2h45m' },
          { t: '12:45', a: 'æŠµé”è˜‡é»ä¸–', d: '-' }, { t: '13:00', a: 'å…¥ä½ãƒ»åˆé¤', d: '1.5h' },
          { t: '15:00', a: 'è˜‡é»ä¸–è³¼ç‰©', d: '2h' }, { t: '17:00', a: 'æ¹–ç•”æ•£æ­¥', d: '1.5h' }
        ], map: ['Geneva Cornavin', 'Zurich HB', 'Bahnhofstrasse Zurich', 'Lake Zurich'] },
        { date: '2/19 (å››)', title: 'ğŸ‡©ğŸ‡ª å¾·åœ‹åº·æ–¯å¦èŒ¨è³¼ç‰©', icon: 'ğŸ›ï¸', loc: 'åº·æ–¯å¦èŒ¨', fam: true, hl: true, schedule: [
          { t: '08:30', a: 'æ—©é¤', d: '30m' }, { t: '09:05', a: 'ğŸš‚ è˜‡é»ä¸–â†’åº·æ–¯å¦èŒ¨', d: '1h15m' },
          { t: '10:20', a: 'æŠµé”åº·æ–¯å¦èŒ¨', d: '-' }, { t: '10:30', a: 'ğŸ›ï¸ dm è—¥å¦åº—', d: '1.5h' },
          { t: '12:00', a: 'åˆé¤', d: '1h' }, { t: '13:00', a: 'ğŸ›ï¸ Rossmann è—¥å¦', d: '1h' },
          { t: '14:00', a: 'ğŸ›ï¸ MÃ¼ller ç™¾è²¨', d: '1h' }, { t: '15:00', a: 'è€åŸæ•£æ­¥', d: '1h' },
          { t: '16:00', a: 'åšç™»æ¹–ç•”', d: '30m' }, { t: '17:05', a: 'ğŸš‚ è¿”å›è˜‡é»ä¸–', d: '1h15m' }
        ], map: ['Zurich HB', 'Konstanz Station', 'Konstanz Old Town', 'Lake Constance'] },
        { date: '2/20 (äº”)', title: 'å®¶äººè¿”ç¨‹', icon: 'âœˆï¸', loc: 'é¦™æ¸¯', fam: true, schedule: [
          { t: '06:30', a: 'èµ·åºŠãƒ»æœ€å¾Œæ•´ç†', d: '30m' }, { t: '07:00', a: 'æ—©é¤ãƒ»é€€æˆ¿', d: '45m' },
          { t: '08:00', a: 'ğŸš‚ å‰å¾€è˜‡é»ä¸–æ©Ÿå ´', d: '30m' }, { t: '08:30', a: 'Check-in', d: '1h' },
          { t: '09:30', a: 'æ©Ÿå ´å…ç¨…åº—', d: '1.5h' }, { t: '11:55', a: 'âœˆï¸ CX382 èµ·é£›', d: '11h20m' },
          { t: '+1æ—¥', a: '06:15 æŠµé”é¦™æ¸¯', d: '-' }
        ], map: ['Zurich Airport'] }
      ],
      glacier: {
        route: ['è–è«é‡ŒèŒ² 1,775m', 'è˜­å¾·ç“¦ç‘Ÿé«˜æ¶æ©‹ ğŸŒ‰', 'åº«çˆ¾ 585mï¼ˆæœ€ä½é»ï¼‰', 'èŠèŒµå³½è°·', 'ä¸Šé˜¿çˆ¾å‘æ–¯å±±å£ 2,033mï¼ˆæœ€é«˜é»ï¼‰', 'å®‰å¾·é¦¬ç‰¹', 'é‡‡çˆ¾é¦¬ç‰¹ 1,604m'],
        tips: ['å³å´åº§ä½çœ‹é«˜æ¶æ©‹æœ€ä½³', 'å»ºè­°é è¨‚è»Šä¸Šåˆé¤', 'é¤è»Šæœ‰å¯é–‹çª—æˆ¶æ‹ç…§', 'æå‰2-3å€‹æœˆé è¨‚']
      },
      budget: [
        { cat: 'transport', label: 'ğŸš‚ äº¤é€š', items: [
          { n: 'Eva è‹±åœ‹â†”ç‘å£«æ©Ÿç¥¨', c: 180, note: '' },
          { n: 'Swiss Travel Pass 8å¤© x3', c: 1347, note: '' },
          { n: 'å†°å·åˆ—è»Šè¨‚ä½è²» x3', c: 147, note: '' },
          { n: 'å°‘å¥³å³°éµè·¯ x3 (75æŠ˜)', c: 510, note: '' },
          { n: 'Gornergrat éµè·¯ x3 (50æŠ˜)', c: 270, note: '' },
          { n: 'å®¶äºº æ—¥å…§ç“¦â†’è˜‡é»ä¸–', c: 174, note: '' },
          { n: 'å®¶äºº å¾·åœ‹åº·æ–¯å¦èŒ¨ä¾†å›', c: 100, note: '' }
        ]},
        { cat: 'hotel', label: 'ğŸ¨ ä½å®¿', items: [
          { n: 'è˜‡é»ä¸– 3æ™š', c: 600, note: '' },
          { n: 'ç‰æ£® 1æ™š', c: 180, note: '' },
          { n: 'æ ¼æ—å¾·ç“¦ 2æ™š', c: 500, note: '' },
          { n: 'è–è«é‡ŒèŒ² 1æ™š', c: 300, note: '' },
          { n: 'é‡‡çˆ¾é¦¬ç‰¹ 2æ™š', c: 500, note: '' },
          { n: 'æ—¥å…§ç“¦ 2æ™š', c: 360, note: '' },
          { n: 'è˜‡é»ä¸– 1æ™š (å®¶äºº)', c: 200, note: '' }
        ]},
        { cat: 'activity', label: 'ğŸ« æ´»å‹•', items: [
          { n: 'åˆ—æ”¯æ•¦å£«ç™»è“‹ç« +å“é…’', c: 60, note: '' },
          { n: 'å†°å·åˆ—è»Šåˆé¤ x3', c: 150, note: '' }
        ]}
      ],
      packing: {
        'ğŸ“„ è­‰ä»¶æ–‡ä»¶': ['è­·ç…§', 'æ©Ÿç¥¨/é›»å­æ©Ÿç¥¨', 'Swiss Travel Pass', 'å†°å·åˆ—è»Šè¨‚ä½ç¢ºèª', 'é…’åº—é è¨‚ç¢ºèª', 'æ—…éŠä¿éšªæ–‡ä»¶', 'ä¿¡ç”¨å¡/ææ¬¾å¡', 'ç‘å£«æ³•éƒç¾é‡‘', 'è­‰ä»¶å½±æœ¬ï¼ˆå‚™ç”¨ï¼‰'],
        'ğŸ§¥ ä¿æš–è¡£ç‰©': ['ç¾½çµ¨å¤–å¥—', 'é˜²æ°´å¤–å¥—/é¢¨è¡£', 'ä¿æš–æ¯›è¡£ x3', 'ç™¼ç†±è¡£ x4', 'ç™¼ç†±è¤² x2', 'åœå·¾', 'æ¯›å¸½', 'æ‰‹å¥—', 'åšè¥ªå­ x4'],
        'ğŸ‘Ÿ é‹å­é…ä»¶': ['é˜²æ°´ç™»å±±é‹', 'å®¤å…§æ‹–é‹', 'å¤ªé™½çœ¼é¡ï¼ˆé›ªåœ°ç”¨ï¼‰', 'å¢¨é¡å¤¾ç‰‡'],
        'ğŸ§´ ç›¥æ´—ç”¨å“': ['ç‰™åˆ·ç‰™è†', 'æ´—é¢ä¹³', 'ä¿æ¿•ä¹³æ¶²', 'è­·å”‡è†', 'é˜²æ›¬ä¹³', 'æ´—é«®ç²¾/æ²æµ´ä¹³', 'æ¯›å·¾', 'æ¢³å­'],
        'ğŸ’Š é†«è—¥ç”¨å“': ['å€‹äººè—¥å“', 'æ„Ÿå†’è—¥', 'è…¸èƒƒè—¥', 'æ­¢ç—›è—¥', 'OKç¹ƒ', 'æšˆè»Šè—¥'],
        'ğŸ“± é›»å­ç”¢å“': ['æ‰‹æ©Ÿ+å……é›»ç·š', 'è¡Œå‹•é›»æº', 'ç›¸æ©Ÿ+è¨˜æ†¶å¡', 'æ­è¦è½‰æ¥é ­', 'è€³æ©Ÿ'],
        'ğŸ’ å…¶ä»–': ['è¡Œæç®±', 'éš¨èº«èƒŒåŒ…', 'é ¸æ•', 'çœ¼ç½©è€³å¡', 'é›¨å‚˜', 'è³¼ç‰©è¢‹', 'é›¶é£Ÿ', 'ä¿æº«ç“¶']
      }
    };

    // State
    let state = {
      rate: 36,
      budget: JSON.parse(localStorage.getItem('swissBudget')) || JSON.parse(JSON.stringify(DEFAULT_DATA.budget)),
      packing: JSON.parse(localStorage.getItem('swissPacking')) || JSON.parse(JSON.stringify(DEFAULT_DATA.packing)),
      checked: JSON.parse(localStorage.getItem('swissChecked')) || {},
      openDays: {}
    };

    function save() {
      localStorage.setItem('swissBudget', JSON.stringify(state.budget));
      localStorage.setItem('swissPacking', JSON.stringify(state.packing));
      localStorage.setItem('swissChecked', JSON.stringify(state.checked));
      localStorage.setItem('swissRate', state.rate);
    }

    // Load rate
    const savedRate = localStorage.getItem('swissRate');
    if (savedRate) state.rate = parseFloat(savedRate);

    function genMapUrl(points) {
      if (!points || points.length === 0) return '';
      if (points.length === 1) return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(points[0])}`;
      const o = encodeURIComponent(points[0]), d = encodeURIComponent(points[points.length - 1]);
      const w = points.slice(1, -1).map(p => encodeURIComponent(p)).join('|');
      return `https://www.google.com/maps/dir/?api=1&origin=${o}&destination=${d}${w ? `&waypoints=${w}` : ''}&travelmode=transit`;
    }

    function openModal(title, bodyHtml) {
      document.getElementById('modal-title').textContent = title;
      document.getElementById('modal-body').innerHTML = bodyHtml;
      document.getElementById('modal').classList.remove('hidden');
    }

    function closeModal() {
      document.getElementById('modal').classList.add('hidden');
    }

    // Itinerary
    function renderItinerary() {
      const el = document.getElementById('itinerary-tab');
      el.innerHTML = '<p style="font-size:0.875rem;color:#6b7280;margin-bottom:12px;">é»æ“Šå±•é–‹æŸ¥çœ‹è©³ç´°è¡Œç¨‹</p>' +
        DEFAULT_DATA.itinerary.map((day, i) => `
          <div class="card ${day.hl ? 'highlight' : ''} ${day.fam ? 'family' : ''}">
            <button class="day-header" onclick="toggleDay(${i})">
              <div class="day-left">
                <span class="day-icon">${day.icon}</span>
                <div>
                  <div class="day-date">${day.date}</div>
                  <div class="day-title">${day.title}</div>
                  <div class="day-loc">ğŸ“ ${day.loc}</div>
                </div>
              </div>
              <div class="day-right">
                ${day.fam ? '<span class="badge badge-family">å®¶äºº</span>' : ''}
                ${day.hl ? '<span class="badge badge-highlight">é‡é»</span>' : ''}
                <span class="arrow" id="arrow-${i}">â–¼</span>
              </div>
            </button>
            <div class="day-content" id="content-${i}">
              <div class="hotel-box">ğŸ¨ ä½å®¿ï¼šå¾…è¨‚</div>
              <div class="schedule">
                ${day.schedule.map(s => `
                  <div class="schedule-item">
                    <span class="schedule-time">${s.t}</span>
                    <div>
                      <div class="schedule-activity">${s.a}</div>
                      ${s.d !== '-' ? `<div class="schedule-duration">â± ${s.d}</div>` : ''}
                    </div>
                  </div>
                `).join('')}
              </div>
              ${day.map?.length ? `<a class="map-btn" href="${genMapUrl(day.map)}" target="_blank">ğŸ—ºï¸ é–‹å•Ÿ Google Maps å°èˆª</a>` : ''}
            </div>
          </div>
        `).join('');
    }

    function toggleDay(i) {
      state.openDays[i] = !state.openDays[i];
      document.getElementById(`content-${i}`).classList.toggle('open', state.openDays[i]);
      document.getElementById(`arrow-${i}`).textContent = state.openDays[i] ? 'â–²' : 'â–¼';
    }

    // Glacier
    function renderGlacier() {
      const el = document.getElementById('glacier-tab');
      el.innerHTML = `
        <div class="card" style="padding:16px;">
          <div class="section-title">â¤ï¸ æƒ…äººç¯€ç‰¹åˆ¥è¡Œç¨‹</div>
          <p style="font-size:0.875rem;color:#4b5563;">2/14ï¼ˆå…­ï¼‰08:38 - 17:07</p>
          <p style="font-size:0.875rem;color:#4b5563;">è–è«é‡ŒèŒ² â†’ é‡‡çˆ¾é¦¬ç‰¹ï½œ8å°æ™‚29åˆ†</p>
        </div>
        <div class="card" style="padding:16px;">
          <div class="section-title">ğŸ”ï¸ è·¯ç·šäº®é»</div>
          ${DEFAULT_DATA.glacier.route.map(r => `<div class="route-item"><div class="route-dot"></div><span>${r}</span></div>`).join('')}
        </div>
        <div class="card" style="padding:16px;">
          <div class="section-title">ğŸ’° ç¥¨åƒ¹ï¼ˆæŒ Swiss Travel Passï¼‰</div>
          <div class="price-row recommended"><span>2ç­‰è»Šå»‚ï¼ˆæ¨è–¦ï¼‰</span><span class="price-value green">CHF 49 â‰ˆ NT$${Math.round(49 * state.rate).toLocaleString()}</span></div>
          <div class="price-row normal"><span>1ç­‰è»Šå»‚</span><span class="price-value">CHF 69 â‰ˆ NT$${Math.round(69 * state.rate).toLocaleString()}</span></div>
        </div>
        <div class="tip-box">
          <h3>ğŸ’¡ å°æé†’</h3>
          <ul>${DEFAULT_DATA.glacier.tips.map(t => `<li>${t}</li>`).join('')}</ul>
        </div>
      `;
    }

    // Budget
    function renderBudget() {
      const total = state.budget.reduce((s, g) => s + g.items.reduce((ss, i) => ss + i.c, 0), 0);
      const el = document.getElementById('budget-tab');
      el.innerHTML = `
        <div class="card" style="padding:16px;">
          <div class="budget-header">
            <h2 style="font-weight:600;font-size:1.125rem;">ğŸ’° é ç®—ç¸½è¦½</h2>
            <div class="rate-badge" onclick="editRate()">
              âš™ï¸ 1 CHF = <span id="rate-display">${state.rate}</span> TWD
            </div>
          </div>
          ${state.budget.map((g, gi) => `
            <div class="budget-cat">${g.label}</div>
            ${g.items.map((item, ii) => `
              <div class="budget-row">
                <div class="budget-item">
                  <div class="budget-item-name">${item.n}</div>
                  ${item.note ? `<div class="budget-item-note">ğŸ’¬ ${item.note}</div>` : ''}
                </div>
                <span class="budget-chf">CHF ${item.c}</span>
                <span class="budget-twd">NT$ ${Math.round(item.c * state.rate).toLocaleString()}</span>
                <div class="budget-actions">
                  <button class="btn-icon edit" onclick="editBudgetItem(${gi}, ${ii})">âœï¸</button>
                  <button class="btn-icon delete" onclick="deleteBudgetItem(${gi}, ${ii})">ğŸ—‘ï¸</button>
                </div>
              </div>
            `).join('')}
          `).join('')}
          <div class="budget-total">
            <span class="budget-total-label">é ä¼°ç¸½è¨ˆ</span>
            <div class="budget-total-value">
              <div class="budget-total-chf">CHF ${total.toLocaleString()}</div>
              <div class="budget-total-twd">â‰ˆ NT$ ${Math.round(total * state.rate).toLocaleString()}</div>
            </div>
          </div>
        </div>
        <button class="add-btn" onclick="addBudgetItem()">â• æ–°å¢é ç®—é …ç›®</button>
        <div class="info-box">ğŸ’¡ ä¸å«é¤è²»ï¼ˆç´„ CHF 50-80/å¤©/äººï¼‰åŠè³¼ç‰©<br>ğŸ‘† é»æ“Šé …ç›®å³å´æŒ‰éˆ•å¯ç·¨è¼¯æˆ–åˆªé™¤</div>
      `;
    }

    function editRate() {
      openModal('âš™ï¸ è¨­å®šåŒ¯ç‡', `
        <div class="form-group">
          <label class="form-label">1 CHF = ? TWD</label>
          <input type="number" id="rate-input" class="form-input" value="${state.rate}" step="0.1">
          <div class="form-hint">ç›®å‰åŒ¯ç‡ç´„ 35-37</div>
        </div>
        <button class="form-btn primary" onclick="saveRate()">å„²å­˜</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
    }

    function saveRate() {
      const val = parseFloat(document.getElementById('rate-input').value);
      if (val > 0) {
        state.rate = val;
        save();
        renderBudget();
        renderGlacier();
        closeModal();
      }
    }

    function addBudgetItem() {
      openModal('â• æ–°å¢é ç®—é …ç›®', `
        <div class="form-group">
          <label class="form-label">é¡åˆ¥</label>
          <select id="budget-cat" class="form-select">
            ${state.budget.map((g, i) => `<option value="${i}">${g.label}</option>`).join('')}
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">é …ç›®åç¨±</label>
          <input type="text" id="budget-name" class="form-input" placeholder="ä¾‹ï¼šç´€å¿µå“">
        </div>
        <div class="form-group">
          <label class="form-label">é‡‘é¡ (CHF)</label>
          <input type="number" id="budget-amount" class="form-input" placeholder="ä¾‹ï¼š50">
          <div class="form-hint" id="budget-twd-hint"></div>
        </div>
        <div class="form-group">
          <label class="form-label">å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
          <input type="text" id="budget-note" class="form-input" placeholder="ä¾‹ï¼šçµ¦å®¶äººçš„ç¦®ç‰©">
        </div>
        <button class="form-btn primary" onclick="saveBudgetItem()">ç¢ºèªæ–°å¢</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
      document.getElementById('budget-amount').addEventListener('input', function() {
        const val = parseFloat(this.value) || 0;
        document.getElementById('budget-twd-hint').textContent = val ? `â‰ˆ NT$ ${Math.round(val * state.rate).toLocaleString()}` : '';
      });
    }

    function saveBudgetItem() {
      const cat = parseInt(document.getElementById('budget-cat').value);
      const name = document.getElementById('budget-name').value.trim();
      const amount = parseFloat(document.getElementById('budget-amount').value);
      const note = document.getElementById('budget-note').value.trim();
      if (!name || !amount) return alert('è«‹å¡«å¯«åç¨±å’Œé‡‘é¡');
      state.budget[cat].items.push({ n: name, c: amount, note: note });
      save();
      renderBudget();
      closeModal();
    }

    function editBudgetItem(gi, ii) {
      const item = state.budget[gi].items[ii];
      openModal('âœï¸ ç·¨è¼¯é …ç›®', `
        <div class="form-group">
          <label class="form-label">é¡åˆ¥</label>
          <select id="budget-cat" class="form-select">
            ${state.budget.map((g, i) => `<option value="${i}" ${i === gi ? 'selected' : ''}>${g.label}</option>`).join('')}
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">é …ç›®åç¨±</label>
          <input type="text" id="budget-name" class="form-input" value="${item.n}">
        </div>
        <div class="form-group">
          <label class="form-label">é‡‘é¡ (CHF)</label>
          <input type="number" id="budget-amount" class="form-input" value="${item.c}">
          <div class="form-hint" id="budget-twd-hint">â‰ˆ NT$ ${Math.round(item.c * state.rate).toLocaleString()}</div>
        </div>
        <div class="form-group">
          <label class="form-label">å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
          <input type="text" id="budget-note" class="form-input" value="${item.note || ''}">
        </div>
        <button class="form-btn primary" onclick="updateBudgetItem(${gi}, ${ii})">å„²å­˜è®Šæ›´</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
      document.getElementById('budget-amount').addEventListener('input', function() {
        const val = parseFloat(this.value) || 0;
        document.getElementById('budget-twd-hint').textContent = val ? `â‰ˆ NT$ ${Math.round(val * state.rate).toLocaleString()}` : '';
      });
    }

    function updateBudgetItem(oldGi, ii) {
      const newGi = parseInt(document.getElementById('budget-cat').value);
      const name = document.getElementById('budget-name').value.trim();
      const amount = parseFloat(document.getElementById('budget-amount').value);
      const note = document.getElementById('budget-note').value.trim();
      if (!name || !amount) return alert('è«‹å¡«å¯«åç¨±å’Œé‡‘é¡');
      
      // Remove from old category
      state.budget[oldGi].items.splice(ii, 1);
      // Add to new category
      state.budget[newGi].items.push({ n: name, c: amount, note: note });
      save();
      renderBudget();
      closeModal();
    }

    function deleteBudgetItem(gi, ii) {
      if (confirm('ç¢ºå®šåˆªé™¤æ­¤é …ç›®ï¼Ÿ')) {
        state.budget[gi].items.splice(ii, 1);
        save();
        renderBudget();
      }
    }

    // Packing
    function renderPacking() {
      const all = Object.values(state.packing).flat();
      const done = all.filter(i => state.checked[i]).length;
      const el = document.getElementById('packing-tab');
      el.innerHTML = `
        <div class="packing-header">
          <div class="packing-title">
            <h2 style="font-weight:600;font-size:1.125rem;">ğŸ§³ æ‰“åŒ…æ¸…å–®</h2>
            <div style="text-align:right;">
              <span class="packing-count ${done === all.length ? 'done' : 'pending'}">${done}/${all.length}</span>
              <div class="packing-subtitle">${done === all.length ? 'âœ… å®Œæˆï¼' : 'ç¹¼çºŒåŠ æ²¹'}</div>
            </div>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:${all.length ? (done/all.length)*100 : 0}%"></div></div>
        </div>
        <div class="packing-btns">
          <button class="add-btn" onclick="addPackingItem()">â• æ–°å¢ç‰©å“</button>
          <button class="add-btn purple" onclick="addPackingCategory()">ğŸ“ æ–°å¢åˆ†é¡</button>
        </div>
        ${Object.entries(state.packing).map(([cat, items]) => {
          const catDone = items.filter(i => state.checked[i]).length;
          return `
            <div class="card" style="padding:16px;">
              <div class="cat-header">
                <span class="cat-title">${cat}</span>
                <div class="cat-actions">
                  <span class="cat-count ${catDone === items.length && items.length ? 'done' : ''}">${catDone}/${items.length}</span>
                  <button class="btn-icon delete" onclick="deletePackingCategory('${cat.replace(/'/g, "\\'")}')">ğŸ—‘ï¸</button>
                </div>
              </div>
              ${items.length ? items.map((item, idx) => `
                <div class="check-item ${state.checked[item] ? 'checked' : ''}" onclick="toggleCheck('${item.replace(/'/g, "\\'")}')">
                  <div class="checkbox">${state.checked[item] ? 'âœ“' : ''}</div>
                  <span class="check-label">${item}</span>
                  <div class="check-actions" onclick="event.stopPropagation()">
                    <button class="btn-icon edit" onclick="editPackingItem('${cat.replace(/'/g, "\\'")}', ${idx})">âœï¸</button>
                    <button class="btn-icon delete" onclick="deletePackingItem('${cat.replace(/'/g, "\\'")}', ${idx})">ğŸ—‘ï¸</button>
                  </div>
                </div>
              `).join('') : '<p style="font-size:0.875rem;color:#9ca3af;text-align:center;padding:12px;">å°šç„¡ç‰©å“</p>'}
            </div>
          `;
        }).join('')}
        <button class="reset-btn" onclick="resetChecked()">ğŸ”„ é‡ç½®å…¨éƒ¨å‹¾é¸</button>
      `;
    }

    function toggleCheck(item) {
      state.checked[item] = !state.checked[item];
      save();
      renderPacking();
    }

    function resetChecked() {
      if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰å‹¾é¸ï¼Ÿ')) {
        state.checked = {};
        save();
        renderPacking();
      }
    }

    function addPackingItem() {
      const cats = Object.keys(state.packing);
      openModal('â• æ–°å¢ç‰©å“', `
        <div class="form-group">
          <label class="form-label">åˆ†é¡</label>
          <select id="packing-cat" class="form-select">
            ${cats.map(c => `<option value="${c}">${c}</option>`).join('')}
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">ç‰©å“åç¨±</label>
          <input type="text" id="packing-name" class="form-input" placeholder="ä¾‹ï¼šè­·ç…§å¥—">
        </div>
        <button class="form-btn primary" onclick="savePackingItem()">ç¢ºèªæ–°å¢</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
    }

    function savePackingItem() {
      const cat = document.getElementById('packing-cat').value;
      const name = document.getElementById('packing-name').value.trim();
      if (!name) return alert('è«‹å¡«å¯«ç‰©å“åç¨±');
      state.packing[cat].push(name);
      save();
      renderPacking();
      closeModal();
    }

    function editPackingItem(cat, idx) {
      const item = state.packing[cat][idx];
      openModal('âœï¸ ç·¨è¼¯ç‰©å“', `
        <div class="form-group">
          <label class="form-label">ç‰©å“åç¨±</label>
          <input type="text" id="packing-name" class="form-input" value="${item}">
        </div>
        <button class="form-btn primary" onclick="updatePackingItem('${cat.replace(/'/g, "\\'")}', ${idx})">å„²å­˜è®Šæ›´</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
    }

    function updatePackingItem(cat, idx) {
      const oldName = state.packing[cat][idx];
      const newName = document.getElementById('packing-name').value.trim();
      if (!newName) return alert('è«‹å¡«å¯«ç‰©å“åç¨±');
      state.packing[cat][idx] = newName;
      // Update checked state
      if (state.checked[oldName]) {
        delete state.checked[oldName];
        state.checked[newName] = true;
      }
      save();
      renderPacking();
      closeModal();
    }

    function deletePackingItem(cat, idx) {
      if (confirm('ç¢ºå®šåˆªé™¤æ­¤ç‰©å“ï¼Ÿ')) {
        const item = state.packing[cat][idx];
        state.packing[cat].splice(idx, 1);
        delete state.checked[item];
        save();
        renderPacking();
      }
    }

    function addPackingCategory() {
      openModal('ğŸ“ æ–°å¢åˆ†é¡', `
        <div class="form-group">
          <label class="form-label">åˆ†é¡åç¨±ï¼ˆå¯åŠ  emojiï¼‰</label>
          <input type="text" id="cat-name" class="form-input" placeholder="ä¾‹ï¼šğŸ ä¼´æ‰‹ç¦®">
        </div>
        <button class="form-btn primary" onclick="savePackingCategory()">ç¢ºèªæ–°å¢</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
    }

    function savePackingCategory() {
      let name = document.getElementById('cat-name').value.trim();
      if (!name) return alert('è«‹å¡«å¯«åˆ†é¡åç¨±');
      if (!name.match(/^[\u{1F300}-\u{1F9FF}]/u)) name = 'ğŸ’ ' + name;
      if (state.packing[name]) return alert('æ­¤åˆ†é¡å·²å­˜åœ¨');
      state.packing[name] = [];
      save();
      renderPacking();
      closeModal();
    }

    function deletePackingCategory(cat) {
      if (confirm(`ç¢ºå®šåˆªé™¤ã€Œ${cat}ã€åˆ†é¡åŠæ‰€æœ‰ç‰©å“ï¼Ÿ`)) {
        state.packing[cat].forEach(item => delete state.checked[item]);
        delete state.packing[cat];
        save();
        renderPacking();
      }
    }

    // Tab switching
    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
      ['itinerary', 'glacier', 'budget', 'packing'].forEach(id => {
        document.getElementById(`${id}-tab`).classList.toggle('hidden', id !== tabId);
      });
    }

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => switchTab(tab.dataset.tab));
    });

    // Close modal on background click
    document.getElementById('modal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });

    // Init
    renderItinerary();
    renderGlacier();
    renderBudget();
    renderPacking();
  </script>
</body>
</html>