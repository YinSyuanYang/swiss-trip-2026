<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>ğŸ‡¨ğŸ‡­ ç‘å£«ä¹‹æ—… 2026</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‡¨ğŸ‡­</text></svg>">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif; background: linear-gradient(to bottom, #fef2f2, #fff); min-height: 100vh; }
    .header { background: linear-gradient(to right, #dc2626, #b91c1c); color: #fff; padding: 20px; border-radius: 0 0 24px 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .header h1 { font-size: 1.25rem; display: flex; align-items: center; gap: 8px; }
    .header p { color: #fecaca; font-size: 0.875rem; margin-top: 4px; }
    .tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    .tag { background: rgba(255,255,255,0.2); padding: 2px 10px; border-radius: 20px; font-size: 0.75rem; }
    .tabs { display: flex; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
    .tab { flex: 1; padding: 10px 2px; border: none; background: none; cursor: pointer; font-size: 0.65rem; color: #6b7280; display: flex; flex-direction: column; align-items: center; gap: 2px; transition: all 0.2s; }
    .tab.active { color: #dc2626; border-bottom: 2px solid #dc2626; }
    .tab-icon { font-size: 1rem; }
    .content { padding: 16px; padding-bottom: 80px; max-width: 500px; margin: 0 auto; }
    .card { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 12px; overflow: hidden; }
    .card.highlight { box-shadow: 0 0 0 2px #ef4444, 0 2px 8px rgba(0,0,0,0.08); }
    .card.family { background: #fffbeb; }
    .day-header { width: 100%; padding: 16px; display: flex; align-items: center; justify-content: space-between; border: none; background: none; cursor: pointer; text-align: left; }
    .day-header:hover { background: #f9fafb; }
    .day-left { display: flex; align-items: center; gap: 12px; }
    .day-icon { font-size: 1.75rem; }
    .day-date { font-size: 0.75rem; color: #6b7280; }
    .day-title { font-weight: 600; color: #1f2937; }
    .day-loc { font-size: 0.75rem; color: #dc2626; }
    .day-right { display: flex; align-items: center; gap: 8px; }
    .badge { font-size: 0.625rem; padding: 2px 8px; border-radius: 20px; }
    .badge-family { background: #fde68a; color: #92400e; }
    .badge-highlight { background: #fee2e2; color: #dc2626; }
    .badge-first { background: #dbeafe; color: #1e40af; }
    .arrow { color: #9ca3af; font-size: 0.875rem; }
    .day-content { padding: 0 16px 16px; border-top: 1px solid #f3f4f6; display: none; }
    .day-content.open { display: block; }
    .hotel-box { margin-top: 12px; padding: 12px; background: #eff6ff; border-radius: 8px; display: flex; align-items: center; gap: 8px; font-size: 0.875rem; }
    .schedule { margin-top: 12px; }
    .schedule-item { display: flex; gap: 12px; padding: 8px 0; font-size: 0.875rem; }
    .schedule-time { width: 48px; color: #dc2626; font-family: monospace; font-weight: 500; flex-shrink: 0; }
    .schedule-activity { flex: 1; color: #374151; }
    .schedule-duration { font-size: 0.75rem; color: #9ca3af; margin-top: 2px; }
    .map-btn { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 12px; background: #16a34a; color: #fff; border: none; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; margin-top: 16px; text-decoration: none; }
    .map-btn:hover { background: #15803d; }
    .section-title { font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .route-item { display: flex; align-items: center; gap: 8px; padding: 8px 0; font-size: 0.875rem; }
    .route-dot { width: 12px; height: 12px; background: #ef4444; border-radius: 50%; }
    .info-box { background: #eff6ff; padding: 16px; border-radius: 12px; font-size: 0.875rem; color: #1e40af; margin-top: 16px; }
    .add-btn { width: 100%; padding: 14px; background: #3b82f6; color: #fff; border: none; border-radius: 12px; font-size: 0.875rem; font-weight: 500; cursor: pointer; margin-top: 12px; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .add-btn:hover { background: #2563eb; }
    .add-btn.purple { background: #8b5cf6; }
    .add-btn.purple:hover { background: #7c3aed; }
    .add-btn.pink { background: #ec4899; }
    .add-btn.pink:hover { background: #db2777; }
    .add-btn.amber { background: #f59e0b; }
    .add-btn.amber:hover { background: #d97706; }
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 200; padding: 16px; }
    .modal.hidden { display: none; }
    .modal-content { background: #fff; border-radius: 16px; padding: 20px; width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .modal-title { font-weight: 600; font-size: 1.125rem; }
    .modal-close { width: 32px; height: 32px; border: none; background: #f3f4f6; border-radius: 8px; cursor: pointer; font-size: 1.25rem; }
    .modal-close:hover { background: #e5e7eb; }
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 0.75rem; color: #6b7280; margin-bottom: 6px; }
    .form-input, .form-select { width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 0.875rem; }
    .form-input:focus, .form-select:focus { outline: none; border-color: #3b82f6; }
    .form-hint { font-size: 0.75rem; color: #9ca3af; margin-top: 4px; }
    .form-btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; }
    .form-btn.primary { background: #22c55e; color: #fff; }
    .form-btn.primary:hover { background: #16a34a; }
    .form-btn.secondary { background: #e5e7eb; color: #374151; margin-top: 8px; }
    .form-btn.secondary:hover { background: #d1d5db; }
    .packing-header { background: #fff; border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); position: sticky; top: 52px; z-index: 50; margin-bottom: 16px; }
    .packing-title { display: flex; justify-content: space-between; align-items: center; }
    .packing-count { font-size: 1.125rem; font-weight: 700; }
    .packing-count.done { color: #16a34a; }
    .packing-count.pending { color: #dc2626; }
    .packing-subtitle { font-size: 0.75rem; color: #6b7280; }
    .progress-bar { height: 12px; background: #e5e7eb; border-radius: 6px; margin-top: 12px; overflow: hidden; }
    .progress-fill { height: 100%; background: #22c55e; transition: width 0.3s; }
    .packing-btns { display: flex; gap: 8px; margin-bottom: 16px; }
    .packing-btns .add-btn { flex: 1; margin: 0; padding: 10px; font-size: 0.8rem; }
    .cat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .cat-title { font-weight: 600; }
    .cat-actions { display: flex; align-items: center; gap: 8px; }
    .cat-count { font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; background: #f3f4f6; }
    .cat-count.done { background: #dcfce7; color: #16a34a; }
    .check-item { display: flex; align-items: center; gap: 12px; padding: 10px 8px; border-radius: 8px; cursor: pointer; }
    .check-item:hover { background: #f9fafb; }
    .check-item.checked { background: #f0fdf4; }
    .checkbox { width: 24px; height: 24px; border: 2px solid #d1d5db; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .check-item.checked .checkbox { background: #22c55e; border-color: #22c55e; color: #fff; }
    .check-label { font-size: 0.875rem; color: #374151; flex: 1; }
    .check-item.checked .check-label { color: #9ca3af; text-decoration: line-through; }
    .check-actions { display: flex; gap: 2px; opacity: 0; }
    .check-item:hover .check-actions { opacity: 1; }
    .btn-icon { width: 28px; height: 28px; border: none; background: none; cursor: pointer; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; }
    .btn-icon:hover { background: #e5e7eb; }
    .btn-icon.edit { color: #3b82f6; }
    .btn-icon.delete { color: #ef4444; }
    .reset-btn { width: 100%; padding: 14px; background: #e5e7eb; color: #4b5563; border: none; border-radius: 12px; font-size: 0.875rem; font-weight: 500; cursor: pointer; margin-top: 16px; }
    .reset-btn:hover { background: #d1d5db; }
    .budget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 8px; }
    .rate-badge { font-size: 0.75rem; background: #f3f4f6; padding: 6px 12px; border-radius: 20px; cursor: pointer; }
    .rate-badge:hover { background: #e5e7eb; }
    .budget-cat { font-weight: 500; color: #374151; margin: 16px 0 8px; }
    .budget-row { display: flex; align-items: center; padding: 10px 0 10px 12px; border-bottom: 1px solid #f3f4f6; font-size: 0.875rem; gap: 8px; }
    .budget-row:hover { background: #f9fafb; }
    .budget-item { flex: 1; color: #4b5563; min-width: 0; }
    .budget-item-name { word-break: break-word; }
    .budget-item-note { font-size: 0.75rem; color: #9ca3af; margin-top: 2px; }
    .budget-chf { width: 70px; text-align: right; flex-shrink: 0; }
    .budget-twd { width: 90px; text-align: right; color: #9ca3af; flex-shrink: 0; font-size: 0.8rem; }
    .budget-actions { display: flex; gap: 4px; opacity: 0; }
    .budget-row:hover .budget-actions { opacity: 1; }
    .budget-total { border-top: 2px solid #fecaca; padding-top: 16px; margin-top: 16px; display: flex; justify-content: space-between; align-items: center; }
    .budget-total-label { font-weight: 600; }
    .budget-total-chf { font-size: 1.25rem; font-weight: 700; color: #dc2626; }
    .budget-total-twd { font-size: 0.875rem; color: #6b7280; }
    .footer { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; border-top: 1px solid #e5e7eb; padding: 12px; text-align: center; font-size: 0.75rem; color: #6b7280; }
    .hidden { display: none !important; }
    .route-section { background: #f9fafb; padding: 12px; border-radius: 8px; margin-top: 12px; }
    .route-section h4 { font-size: 0.875rem; margin-bottom: 8px; color: #374151; }
    .booking-info { background: #dbeafe; padding: 12px; border-radius: 8px; margin-top: 12px; font-size: 0.8rem; }
    .booking-info div { margin-bottom: 4px; }
    .booking-info strong { color: #1e40af; }
    .lock-screen { text-align: center; padding: 60px 20px; }
    .lock-icon { font-size: 4rem; margin-bottom: 16px; }
    .lock-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 8px; }
    .lock-desc { color: #6b7280; font-size: 0.875rem; margin-bottom: 24px; }
    .password-input { width: 200px; padding: 12px 16px; border: 2px solid #d1d5db; border-radius: 12px; font-size: 1.25rem; text-align: center; letter-spacing: 8px; }
    .password-input:focus { outline: none; border-color: #3b82f6; }
    .unlock-btn { margin-top: 16px; padding: 12px 32px; background: #3b82f6; color: #fff; border: none; border-radius: 12px; font-size: 1rem; font-weight: 500; cursor: pointer; }
    .unlock-btn:hover { background: #2563eb; }
    .error-msg { color: #dc2626; font-size: 0.875rem; margin-top: 12px; }
    .file-category { margin-bottom: 20px; }
    .file-cat-header { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f3f4f6; border-radius: 8px; margin-bottom: 8px; }
    .file-cat-name { font-weight: 600; }
    .file-cat-count { font-size: 0.75rem; color: #6b7280; }
    .file-item { display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 8px; }
    .file-item:hover { background: #f9fafb; }
    .file-icon { font-size: 1.5rem; }
    .file-info { flex: 1; min-width: 0; }
    .file-name { font-weight: 500; font-size: 0.875rem; word-break: break-word; }
    .file-meta { font-size: 0.75rem; color: #9ca3af; }
    .file-actions { display: flex; gap: 4px; }
    .upload-zone { border: 2px dashed #d1d5db; border-radius: 12px; padding: 32px; text-align: center; cursor: pointer; margin-bottom: 16px; }
    .upload-zone:hover { border-color: #3b82f6; background: #eff6ff; }
    .upload-zone.dragover { border-color: #3b82f6; background: #dbeafe; }
    .upload-icon { font-size: 2.5rem; margin-bottom: 8px; }
    .upload-text { color: #6b7280; font-size: 0.875rem; }
    .upload-hint { color: #9ca3af; font-size: 0.75rem; margin-top: 4px; }
    /* Hotel tab */
    .hotel-card { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 16px; overflow: hidden; }
    .hotel-card-header { padding: 16px; background: linear-gradient(to right, #7c3aed, #6d28d9); color: #fff; }
    .hotel-location { font-size: 1rem; font-weight: 600; }
    .hotel-location-en { font-size: 0.75rem; opacity: 0.9; }
    .hotel-dates { font-size: 0.875rem; opacity: 0.9; margin-top: 4px; }
    .hotel-nights { display: inline-block; background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; margin-left: 8px; }
    .hotel-card-body { padding: 16px; }
    .hotel-section { margin-bottom: 16px; }
    .hotel-section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #e5e7eb; }
    .hotel-section-title { font-weight: 600; font-size: 0.875rem; display: flex; align-items: center; gap: 6px; }
    .hotel-section-title.airbnb { color: #ec4899; }
    .hotel-section-title.hotel { color: #f59e0b; }
    .airbnb-list-link { display: flex; align-items: center; gap: 8px; padding: 10px 12px; background: #fdf2f8; border: 1px solid #fbcfe8; border-radius: 8px; margin-bottom: 8px; }
    .airbnb-list-link a { color: #ec4899; font-size: 0.8rem; flex: 1; word-break: break-all; }
    .hotel-option { display: flex; align-items: flex-start; gap: 12px; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 8px; }
    .hotel-option:hover { border-color: #7c3aed; background: #faf5ff; }
    .hotel-option.selected { border-color: #7c3aed; background: #f3e8ff; }
    .hotel-option.airbnb { border-left: 3px solid #ec4899; }
    .hotel-option.hotel-type { border-left: 3px solid #f59e0b; }
    .option-number { width: 24px; height: 24px; background: #7c3aed; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.75rem; flex-shrink: 0; }
    .option-number.airbnb { background: #ec4899; }
    .option-number.hotel-type { background: #f59e0b; }
    .option-info { flex: 1; min-width: 0; }
    .option-name { font-weight: 500; font-size: 0.875rem; word-break: break-word; }
    .option-price { font-size: 0.75rem; color: #6b7280; margin-top: 4px; }
    .option-price-detail { font-size: 0.7rem; color: #9ca3af; }
    .option-link { color: #7c3aed; text-decoration: none; font-size: 0.75rem; display: inline-block; margin-top: 4px; }
    .option-link:hover { text-decoration: underline; }
    .option-actions { display: flex; flex-direction: column; gap: 4px; }
    .no-options { text-align: center; padding: 16px; color: #9ca3af; font-size: 0.875rem; }
    .add-option-btn { width: 100%; padding: 8px; background: #f3e8ff; color: #7c3aed; border: 1px dashed #7c3aed; border-radius: 8px; font-size: 0.8rem; cursor: pointer; margin-top: 8px; }
    .add-option-btn:hover { background: #ede9fe; }
    .add-option-btn.airbnb { background: #fdf2f8; color: #ec4899; border-color: #ec4899; }
    .add-option-btn.airbnb:hover { background: #fce7f3; }
    .add-option-btn.hotel-type { background: #fffbeb; color: #f59e0b; border-color: #f59e0b; }
    .add-option-btn.hotel-type:hover { background: #fef3c7; }
    @media (max-width: 400px) {
      .budget-twd { display: none; }
      .budget-actions, .check-actions, .file-actions, .option-actions { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1><span>ğŸ‡¨ğŸ‡­</span> ç‘å£«ä¹‹æ—… 2026</h1>
    <p>2/7 - 2/20 ï½œ14å¤©ï½œ5äºº</p>
    <div class="tags">
      <span class="tag">å†°å·åˆ—è»Š ğŸš‚</span>
      <span class="tag">é¦¬ç‰¹æ´ªå³°</span>
      <span class="tag">å°‘å¥³å³°</span>
    </div>
  </div>

  <div class="tabs">
    <button class="tab active" data-tab="itinerary"><span class="tab-icon">ğŸ“…</span>è¡Œç¨‹</button>
    <button class="tab" data-tab="hotel"><span class="tab-icon">ğŸ¨</span>ä½å®¿</button>
    <button class="tab" data-tab="budget"><span class="tab-icon">ğŸ’°</span>é ç®—</button>
    <button class="tab" data-tab="packing"><span class="tab-icon">ğŸ§³</span>æ‰“åŒ…</button>
    <button class="tab" data-tab="files"><span class="tab-icon">ğŸ“</span>æ–‡ä»¶</button>
  </div>

  <div class="content">
    <div id="itinerary-tab"></div>
    <div id="hotel-tab" class="hidden"></div>
    <div id="budget-tab" class="hidden"></div>
    <div id="packing-tab" class="hidden"></div>
    <div id="files-tab" class="hidden"></div>
  </div>

  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title" id="modal-title">æ–°å¢</span>
        <button class="modal-close" onclick="closeModal()">Ã—</button>
      </div>
      <div id="modal-body"></div>
    </div>
  </div>

  <div class="footer">ğŸ‡¨ğŸ‡­ ç‘å£«ä¹‹æ—… 2026 ï½œâ¤ï¸</div>

  <script>
    const DEFAULT_DATA = {
      itinerary: [
        { date: '2/7 (å…­)', title: 'EvaæŠµé”è˜‡é»ä¸–', icon: 'âœˆï¸', loc: 'è˜‡é»ä¸–', hotel: 'è˜‡é»ä¸– Zurich HB', schedule: [
          { t: '15:00', a: 'æŠµé”è˜‡é»ä¸–æ©Ÿå ´', d: '-' }, { t: '16:00', a: 'å…¥ä½é…’åº—', d: '1h' },
          { t: '17:00', a: 'ç­éœå¤«å¤§è¡—è³¼ç‰©', d: '1.5h' }, { t: '20:00', a: 'è€åŸæ™šé¤', d: '1.5h' }
        ], map: ['Zurich Airport', 'Zurich HB'], route: 'è‹±åœ‹ âœˆï¸ â†’ è˜‡é»ä¸–' },
        { date: '2/8 (æ—¥)', title: 'å®¶äººæŠµé”ãƒ»æœƒåˆï¼', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', loc: 'è˜‡é»ä¸–', hotel: 'è˜‡é»ä¸– Zurich HB', hl: true, schedule: [
          { t: '07:30', a: 'ğŸ›¬ å®¶äººæŠµé”', d: '-' }, { t: '10:30', a: 'é…’åº—ä¼‘æ¯', d: '2h' },
          { t: '13:00', a: 'åˆé¤ Zeughauskeller', d: '1h' }, { t: '14:30', a: 'è˜‡é»ä¸–æ¹–ç•”', d: '1.5h' }
        ], map: ['Zurich Airport', 'Lake Zurich'], route: 'å°ç£ âœˆï¸ â†’ è˜‡é»ä¸–' },
        { date: '2/9 (ä¸€)', title: 'ğŸ‡±ğŸ‡® åˆ—æ”¯æ•¦å£«ç™»', icon: 'ğŸ°', loc: 'ç“¦æœèŒ²', hotel: 'è˜‡é»ä¸– Zurich HB', schedule: [
          { t: '08:30', a: 'ğŸš‚ è˜‡é»ä¸–å‡ºç™¼', d: '1.5h' }, { t: '10:30', a: 'è­·ç…§è“‹ç« ', d: '30m' },
          { t: '11:00', a: 'ç“¦æœèŒ²åŸå ¡', d: '1h' }, { t: '17:00', a: 'è¿”å›è˜‡é»ä¸–', d: '1.5h' }
        ], map: ['Zurich HB', 'Vaduz'], route: 'è˜‡é»ä¸– ğŸš‚ â†’ ç“¦æœèŒ² â†’ è˜‡é»ä¸–' },
        { date: '2/10 (äºŒ)', title: 'ç‰æ£®', icon: 'ğŸ¦', loc: 'ç‰æ£®', hotel: 'è˜‡é»ä¸– Zurich HB', schedule: [
          { t: '09:00', a: 'ğŸš‚ è˜‡é»ä¸–â†’ç‰æ£®', d: '45m' }, { t: '10:00', a: 'ç…å­ç´€å¿µç¢‘', d: '30m' },
          { t: '13:30', a: 'å¡è²çˆ¾æ©‹', d: '30m' }, { t: '18:00', a: 'æ¹–ç•”æ™šé¤', d: '2h' }
        ], map: ['Luzern Station', 'Chapel Bridge Luzern'], route: 'è˜‡é»ä¸– ğŸš‚ â†’ ç‰æ£® â†’ è˜‡é»ä¸–' },
        { date: '2/11 (ä¸‰)', title: 'å‰å¾€è–è«é‡ŒèŒ²', icon: 'ğŸ¿', loc: 'è–è«é‡ŒèŒ²', hotel: 'è–è«é‡ŒèŒ² St. Moritz', schedule: [
          { t: '09:00', a: 'ğŸš‚ è˜‡é»ä¸–â†’è–è«é‡ŒèŒ²', d: '3h' }, { t: '13:00', a: 'åˆé¤', d: '1h' },
          { t: '14:30', a: 'è–è«é‡ŒèŒ²æ¹–æ•£æ­¥', d: '1.5h' }, { t: '20:30', a: 'æ—©ç¡', d: '-' }
        ], map: ['St Moritz'], route: 'è˜‡é»ä¸– ğŸš‚ â†’ è–è«é‡ŒèŒ²ï¼ˆ3å°æ™‚ï¼‰' },
        { date: '2/12 (å››)', title: 'ğŸš‚ å†°å·åˆ—è»Š', icon: 'ğŸš‚', loc: 'é‡‡çˆ¾é¦¬ç‰¹', hotel: 'é‡‡çˆ¾é¦¬ç‰¹ Zermatt', hl: true, first: true, schedule: [
          { t: '08:38', a: 'ğŸš‚ å†°å·åˆ—è»Šå‡ºç™¼ï¼', d: '8h30m' }, { t: '12:00', a: 'è»Šä¸Šåˆé¤', d: '1.5h' },
          { t: '17:07', a: 'æŠµé”é‡‡çˆ¾é¦¬ç‰¹', d: '-' }, { t: '19:30', a: 'æ™šé¤', d: '2h' }
        ], map: ['St Moritz Station', 'Zermatt'], route: 'è–è«é‡ŒèŒ² ğŸš‚ â†’ é‡‡çˆ¾é¦¬ç‰¹',
        booking: { train: '903', car: '24', seats: '21-22, 24-26', class: 'é ­ç­‰è‰™', meal: '2é“å¼åˆé¤x5' } },
        { date: '2/13 (äº”)', title: 'é¦¬ç‰¹æ´ªå³°', icon: 'ğŸ”ï¸', loc: 'é‡‡çˆ¾é¦¬ç‰¹', hotel: 'é‡‡çˆ¾é¦¬ç‰¹ Zermatt', schedule: [
          { t: '09:00', a: 'ğŸš‚ Gornergrat ç™»å±±éµè·¯', d: '33m' }, { t: '10:00', a: 'é¦¬ç‰¹æ´ªå³°è§€æ™¯', d: '2h' },
          { t: '12:00', a: 'å±±é ‚åˆé¤', d: '1h' }, { t: '17:00', a: 'å°é®è³¼ç‰©', d: '2h' }
        ], map: ['Zermatt', 'Gornergrat'], route: 'é‡‡çˆ¾é¦¬ç‰¹ ğŸš‚ â†’ Gornergrat' },
        { date: '2/14 (å…­)', title: 'â¤ï¸ æƒ…äººç¯€', icon: 'â¤ï¸', loc: 'é‡‡çˆ¾é¦¬ç‰¹', hotel: 'é‡‡çˆ¾é¦¬ç‰¹ Zermatt', hl: true, schedule: [
          { t: '09:00', a: 'ç¡åˆ°è‡ªç„¶é†’', d: '2h' }, { t: '11:00', a: 'Sunnegga çºœè»Š', d: '3m' },
          { t: '17:00', a: 'Spa / ä¼‘æ¯', d: '2h' }, { t: '19:30', a: 'â¤ï¸ æƒ…äººç¯€æ™šé¤', d: '2.5h' }
        ], map: ['Zermatt', 'Sunnegga'], route: 'é‡‡çˆ¾é¦¬ç‰¹æ‚ é–’æ—¥' },
        { date: '2/15 (æ—¥)', title: 'å‰å¾€å› ç‰¹æ‹‰è‚¯', icon: 'ğŸ”ï¸', loc: 'å› ç‰¹æ‹‰è‚¯', hotel: 'å› ç‰¹æ‹‰è‚¯ Interlaken Ost', schedule: [
          { t: '09:15', a: 'ğŸš‚ é‡‡çˆ¾é¦¬ç‰¹â†’å› ç‰¹æ‹‰è‚¯', d: '2h30m' }, { t: '13:00', a: 'åˆé¤', d: '1h' },
          { t: '14:30', a: 'å°é®æ¼«æ­¥', d: '2h' }, { t: '19:30', a: 'æ™šé¤', d: '2h' }
        ], map: ['Interlaken Ost'], route: 'é‡‡çˆ¾é¦¬ç‰¹ ğŸš‚ â†’ å› ç‰¹æ‹‰è‚¯' },
        { date: '2/16 (ä¸€)', title: 'â­ å°‘å¥³å³°', icon: 'ğŸ—»', loc: 'å°‘å¥³å³°', hotel: 'å› ç‰¹æ‹‰è‚¯ Interlaken Ost', hl: true, schedule: [
          { t: '08:30', a: 'ğŸš¡ Eiger Express', d: '15m' }, { t: '09:30', a: 'å°‘å¥³å³°ç«™ 3,454m', d: '-' },
          { t: '10:00', a: 'æ–¯èŠ¬å…‹æ–¯è§€æ™¯å°', d: '1h' }, { t: '15:30', a: 'ä¸‹å±±', d: '1h' }
        ], map: ['Jungfraujoch'], route: 'å› ç‰¹æ‹‰è‚¯ â†’ å°‘å¥³å³°' },
        { date: '2/17 (äºŒ)', title: 'Evaè¿”å›è‹±åœ‹', icon: 'âœˆï¸', loc: 'æ—¥å…§ç“¦', hotel: 'æ—¥å…§ç“¦ Geneva Cornavin', schedule: [
          { t: '08:30', a: 'ğŸš‚ å› ç‰¹æ‹‰è‚¯â†’æ—¥å…§ç“¦', d: '2h45m' }, { t: '12:00', a: 'Evaå‰å¾€æ©Ÿå ´', d: '20m' },
          { t: '14:00', a: 'å¤§å™´æ³‰', d: '30m' }, { t: '19:00', a: 'æ¹–ç•”æ™šé¤', d: '2h' }
        ], map: ['Geneva'], route: 'å› ç‰¹æ‹‰è‚¯ ğŸš‚ â†’ æ—¥å…§ç“¦' },
        { date: '2/18 (ä¸‰)', title: 'æ—¥å…§ç“¦è§€å…‰', icon: 'â›²', loc: 'æ—¥å…§ç“¦', hotel: 'æ—¥å…§ç“¦ Geneva Cornavin', fam: true, schedule: [
          { t: '10:00', a: 'æ—¥å…§ç“¦æ¹–éŠèˆ¹', d: '1.5h' }, { t: '15:00', a: 'ç´…åå­—æœƒåšç‰©é¤¨', d: '2h' },
          { t: '19:30', a: 'æ™šé¤', d: '2h' }
        ], map: ['Lake Geneva'], route: 'æ—¥å…§ç“¦å¸‚å€' },
        { date: '2/19 (å››)', title: 'ğŸ‡©ğŸ‡ªå¾·åœ‹è³¼ç‰©', icon: 'ğŸ›ï¸', loc: 'è˜‡é»ä¸–', hotel: 'è˜‡é»ä¸– Zurich HB', fam: true, hl: true, schedule: [
          { t: '09:30', a: 'ğŸš‚ æ—¥å…§ç“¦â†’è˜‡é»ä¸–', d: '2h45m' }, { t: '14:00', a: 'ğŸš‚ è˜‡é»ä¸–â†’åº·æ–¯å¦èŒ¨', d: '1h15m' },
          { t: '15:15', a: 'dm è—¥å¦åº—', d: '1h' }, { t: '18:00', a: 'è¿”å›è˜‡é»ä¸–', d: '1h15m' }
        ], map: ['Konstanz'], route: 'æ—¥å…§ç“¦ ğŸš‚ â†’ è˜‡é»ä¸– ğŸš‚ â†’ åº·æ–¯å¦èŒ¨ğŸ‡©ğŸ‡ª' },
        { date: '2/20 (äº”)', title: 'å®¶äººè¿”ç¨‹', icon: 'âœˆï¸', loc: 'é¦™æ¸¯', hotel: '', fam: true, schedule: [
          { t: '08:00', a: 'å‰å¾€æ©Ÿå ´', d: '15m' }, { t: '11:55', a: 'âœˆï¸ CX382 èµ·é£›', d: '11h20m' },
          { t: '+1æ—¥', a: '06:15 æŠµé”é¦™æ¸¯', d: '-' }
        ], map: ['Zurich Airport'], route: 'è˜‡é»ä¸– âœˆï¸ â†’ é¦™æ¸¯' }
      ],
      hotels: [
        { id: 1, location: 'è˜‡é»ä¸–', locationEn: 'Zurich HB / Hauptbahnhof', checkIn: '2/7 (å…­)', checkOut: '2/11 (ä¸‰)', nights: 4, note: 'Eva 2/7å…ˆåˆ°', airbnbListUrl: 'https://www.airbnb.co.uk/wishlists/invite/3dddc27c-72a6-4c48-97b3-f0149aecb5e6?s=67&unique_share_id=22e5018b-633a-4ea7-b067-594c3d4abaad', airbnbs: [], hotels: [] },
        { id: 2, location: 'è–è«é‡ŒèŒ²', locationEn: 'St. Moritz Dorf / Station', checkIn: '2/11 (ä¸‰)', checkOut: '2/12 (å››)', nights: 1, note: 'å†°å·åˆ—è»Šå‰ä¸€æ™š', airbnbListUrl: '', airbnbs: [], hotels: [
          { name: 'Hotel Schweizerhof St. Moritz', pricePerNight: 1190, url: 'https://www.simplebooking.it/ibe2/hotel/4942?lang=EN&cur=CHF', selected: false },
          { name: 'HOTEL STEFFANI', pricePerNight: 1172, url: 'https://steffani.ch/', selected: false }
        ] },
        { id: 3, location: 'é‡‡çˆ¾é¦¬ç‰¹', locationEn: 'Zermatt Station / Bahnhofstrasse', checkIn: '2/12 (å››)', checkOut: '2/15 (æ—¥)', nights: 3, note: 'å«æƒ…äººç¯€â¤ï¸', airbnbListUrl: '', airbnbs: [], hotels: [
          { name: 'Schweizerhof Zermatt', pricePerNight: 607.5, url: 'https://www.schweizerhofzermatt.ch/en/', selected: false },
          { name: 'Vrony Apartments by Hotel Walliserhof', pricePerNight: 865, url: 'https://www.booking.com/hotel/ch/the-rooftop-by-walliserhof-zermatt.en-gb.html', selected: false },
          { name: 'Hotel Ambassador Zermatt', pricePerNight: 1464, url: 'https://www.booking.com/hotel/ch/ambassador-zermatt.en-gb.html', selected: false }
        ] },
        { id: 4, location: 'å› ç‰¹æ‹‰è‚¯', locationEn: 'Interlaken Ost (æ±ç«™)', checkIn: '2/15 (æ—¥)', checkOut: '2/17 (äºŒ)', nights: 2, note: 'å°‘å¥³å³°å‡ºç™¼ç«™', airbnbListUrl: '', airbnbs: [
          { name: 'River-Kissed Retreat with Jungfraujoch View', pricePerNight: 467, url: 'https://www.airbnb.co.uk/rooms/1434225833129440565?adults=5&check_in=2026-02-15&check_out=2026-02-17', selected: false },
          { name: 'Swiss Hotel Apartments - Two Bedroom', pricePerNight: 876.26, url: 'https://www.airbnb.co.uk/rooms/45729237?adults=5&check_in=2026-02-15&check_out=2026-02-17', selected: false }
        ], hotels: [
          { name: 'Stay Switzerland Apartments', pricePerNight: 597, url: 'https://www.booking.com/hotel/ch/mountain-view-apartment-interlaken.en-gb.html', selected: false },
          { name: 'Modern City Apartments', pricePerNight: 625, url: 'https://www.booking.com/hotel/ch/modern-city-apartment.en-gb.html', selected: false },
          { name: 'Downtown Family&Friends', pricePerNight: 236, url: 'https://www.booking.com/hotel/ch/downtown-family-rooms-interlaken.en-gb.html', selected: false }
        ] },
        { id: 5, location: 'æ—¥å…§ç“¦', locationEn: 'Geneva Cornavin', checkIn: '2/17 (äºŒ)', checkOut: '2/19 (å››)', nights: 2, note: 'å®¶äººç¨è‡ª', airbnbListUrl: '', airbnbs: [], hotels: [
          { name: 'Hotel Cristal Design', pricePerNight: 366, url: 'https://www.booking.com/hotel/ch/christal.en-gb.html', selected: false },
          { name: 'Hotel International & Terminus', pricePerNight: 403, url: 'https://www.booking.com/hotel/ch/international-terminus.en-gb.html', selected: false },
          { name: 'ibis Geneve Centre Lac', pricePerNight: 325, url: 'https://www.booking.com/hotel/ch/ibis-geneve-centre-lac.html', selected: false }
        ] },
        { id: 6, location: 'è˜‡é»ä¸–', locationEn: 'Zurich HB / Hauptbahnhof', checkIn: '2/19 (å››)', checkOut: '2/20 (äº”)', nights: 1, note: 'å›ç¨‹å‰ä¸€æ™š', airbnbListUrl: '', airbnbs: [], hotels: [
          { name: 'Hotel Bristol Zurich', pricePerNight: 284, url: 'https://www.booking.com/hotel/ch/bristol.en-gb.html', selected: false },
          { name: 'Aparthotel Adagio Zurich City Center', pricePerNight: 322, url: 'https://www.booking.com/hotel/ch/aparthotel-adagio-zurich-center.en-gb.html', selected: false },
          { name: 'Townhouse Boutique Hotel', pricePerNight: 482, url: 'https://www.booking.com/hotel/ch/townhouse-boutique.en-gb.html', selected: false }
        ] }
      ],
      budget: [
        { cat: 'transport', label: 'ğŸš‚ äº¤é€š', items: [
          { n: 'Eva è‹±åœ‹â†”ç‘å£«æ©Ÿç¥¨', c: 180, note: '' },
          { n: 'Swiss Travel Pass 8å¤© x5', c: 2245, note: 'CHF 449/äºº' },
          { n: 'å†°å·åˆ—è»Šè¨‚ä½è²» x5ï¼ˆé ­ç­‰ï¼‰', c: 345, note: 'CHF 69/äºº' },
          { n: 'å†°å·åˆ—è»Šåˆé¤ x5', c: 210, note: '' },
          { n: 'å°‘å¥³å³°éµè·¯ x5', c: 850, note: '' },
          { n: 'Gornergrat éµè·¯ x5', c: 450, note: '' }
        ]},
        { cat: 'hotel', label: 'ğŸ¨ ä½å®¿', items: [
          { n: 'è˜‡é»ä¸– 4æ™š', c: 800, note: '' },
          { n: 'è–è«é‡ŒèŒ² 1æ™š', c: 300, note: '' },
          { n: 'é‡‡çˆ¾é¦¬ç‰¹ 3æ™š', c: 750, note: '' },
          { n: 'å› ç‰¹æ‹‰è‚¯ 2æ™š', c: 400, note: '' },
          { n: 'æ—¥å…§ç“¦ 2æ™š', c: 360, note: '' },
          { n: 'è˜‡é»ä¸– 1æ™š', c: 200, note: '' }
        ]},
        { cat: 'activity', label: 'ğŸ« æ´»å‹•', items: [
          { n: 'åˆ—æ”¯æ•¦å£«ç™»', c: 75, note: '' }
        ]}
      ],
      packing: {
        'ğŸ“„ è­‰ä»¶': ['è­·ç…§ x5', 'Swiss Travel Pass x5', 'å†°å·åˆ—è»Šè¨‚ä½ç¢ºèª', 'é…’åº—é è¨‚ç¢ºèª'],
        'ğŸ§¥ è¡£ç‰©': ['ç¾½çµ¨å¤–å¥—', 'é˜²æ°´å¤–å¥—', 'æ¯›è¡£ x3', 'ç™¼ç†±è¡£ x4', 'åœå·¾', 'æ¯›å¸½', 'æ‰‹å¥—'],
        'ğŸ§´ ç›¥æ´—': ['ç‰™åˆ·ç‰™è†', 'ä¿æ¿•ä¹³æ¶²', 'è­·å”‡è†', 'é˜²æ›¬ä¹³'],
        'ğŸ“± é›»å­': ['æ‰‹æ©Ÿ+å……é›»ç·š', 'è¡Œå‹•é›»æº', 'æ­è¦è½‰æ¥é ­']
      },
      fileCategories: ['Swiss Pass', 'å†°å·åˆ—è»Š', 'é…’åº—ç¢ºèª', 'æ©Ÿç¥¨', 'å…¶ä»–']
    };

    const FILE_PASSWORD = '558894';
    // ä½¿ç”¨ DEFAULT_DATA ä½œç‚ºåŸºç¤ï¼Œåˆä½µç”¨æˆ¶çš„ selected ç‹€æ…‹
    function loadHotels() {
      const saved = JSON.parse(localStorage.getItem('swissHotelsSelected')) || {};
      return DEFAULT_DATA.hotels.map(h => ({
        ...h,
        airbnbs: h.airbnbs.map((a, i) => ({ ...a, selected: saved[`${h.id}-a-${i}`] || false })),
        hotels: h.hotels.map((hotel, i) => ({ ...hotel, selected: saved[`${h.id}-h-${i}`] || false }))
      }));
    }

    let state = {
      rate: 36,
      budget: JSON.parse(localStorage.getItem('swissBudget5')) || JSON.parse(JSON.stringify(DEFAULT_DATA.budget)),
      packing: JSON.parse(localStorage.getItem('swissPacking5')) || JSON.parse(JSON.stringify(DEFAULT_DATA.packing)),
      checked: JSON.parse(localStorage.getItem('swissChecked5')) || {},
      files: JSON.parse(localStorage.getItem('swissFiles3')) || [],
      fileCategories: JSON.parse(localStorage.getItem('swissFileCats3')) || [...DEFAULT_DATA.fileCategories],
      hotels: loadHotels(),
      filesUnlocked: false,
      openDays: {}
    };

    function save() {
      localStorage.setItem('swissBudget5', JSON.stringify(state.budget));
      localStorage.setItem('swissPacking5', JSON.stringify(state.packing));
      localStorage.setItem('swissChecked5', JSON.stringify(state.checked));
      localStorage.setItem('swissFiles3', JSON.stringify(state.files));
      localStorage.setItem('swissFileCats3', JSON.stringify(state.fileCategories));
      localStorage.setItem('swissRate5', state.rate);
      // åªå„²å­˜ selected ç‹€æ…‹
      const selectedMap = {};
      state.hotels.forEach(h => {
        h.airbnbs.forEach((a, i) => { if (a.selected) selectedMap[`${h.id}-a-${i}`] = true; });
        h.hotels.forEach((hotel, i) => { if (hotel.selected) selectedMap[`${h.id}-h-${i}`] = true; });
      });
      localStorage.setItem('swissHotelsSelected', JSON.stringify(selectedMap));
    }

    const savedRate = localStorage.getItem('swissRate5');
    if (savedRate) state.rate = parseFloat(savedRate);

    function genMapUrl(points) {
      if (!points?.length) return '';
      return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(points[0])}`;
    }

    function formatPrice(chf, nights) {
      const total = chf * nights;
      const twdPerNight = Math.round(chf * state.rate);
      const twdTotal = Math.round(total * state.rate);
      return {
        perNight: `CHF ${chf}/æ™š (NT$${twdPerNight.toLocaleString()})`,
        total: `ç¸½è¨ˆ CHF ${total} (NT$${twdTotal.toLocaleString()})`
      };
    }

    function openModal(title, bodyHtml) {
      document.getElementById('modal-title').textContent = title;
      document.getElementById('modal-body').innerHTML = bodyHtml;
      document.getElementById('modal').classList.remove('hidden');
    }
    function closeModal() { document.getElementById('modal').classList.add('hidden'); }

    // Itinerary
    function renderItinerary() {
      document.getElementById('itinerary-tab').innerHTML = DEFAULT_DATA.itinerary.map((day, i) => `
        <div class="card ${day.hl ? 'highlight' : ''} ${day.fam ? 'family' : ''}">
          <button class="day-header" onclick="toggleDay(${i})">
            <div class="day-left">
              <span class="day-icon">${day.icon}</span>
              <div>
                <div class="day-date">${day.date}</div>
                <div class="day-title">${day.title}</div>
                <div class="day-loc">ğŸ“ ${day.loc}</div>
                ${day.hotel ? `<div class="day-loc" style="color:#7c3aed;">ğŸ¨ ${day.hotel}</div>` : ''}
              </div>
            </div>
            <div class="day-right">
              ${day.first ? '<span class="badge badge-first">é ­ç­‰è‰™</span>' : ''}
              ${day.fam ? '<span class="badge badge-family">å®¶äºº</span>' : ''}
              ${day.hl ? '<span class="badge badge-highlight">é‡é»</span>' : ''}
              <span class="arrow" id="arrow-${i}">â–¼</span>
            </div>
          </button>
          <div class="day-content" id="content-${i}">
            ${day.route ? `<div class="route-section"><h4>ğŸš‚ äº¤é€š</h4><div>${day.route}</div></div>` : ''}
            ${day.booking ? `<div class="booking-info"><strong>ğŸ« è¨‚ä½</strong><br>è»Šå»‚${day.booking.car} åº§ä½${day.booking.seats}<br>${day.booking.class} ${day.booking.meal}</div>` : ''}
            <div class="schedule">${day.schedule.map(s => `
              <div class="schedule-item">
                <span class="schedule-time">${s.t}</span>
                <div><div class="schedule-activity">${s.a}</div>${s.d !== '-' ? `<div class="schedule-duration">â± ${s.d}</div>` : ''}</div>
              </div>`).join('')}
            </div>
            ${day.map?.length ? `<a class="map-btn" href="${genMapUrl(day.map)}" target="_blank">ğŸ—ºï¸ Google Maps</a>` : ''}
          </div>
        </div>
      `).join('');
    }

    function toggleDay(i) {
      state.openDays[i] = !state.openDays[i];
      document.getElementById(`content-${i}`).classList.toggle('open', state.openDays[i]);
      document.getElementById(`arrow-${i}`).textContent = state.openDays[i] ? 'â–²' : 'â–¼';
    }

    // Hotels
    function renderHotels() {
      document.getElementById('hotel-tab').innerHTML = `
        <div class="info-box" style="margin-bottom:16px;">
          ğŸ’¡ åŒ¯ç‡ï¼š1 CHF = ${state.rate} TWD <span onclick="editRate()" style="cursor:pointer;text-decoration:underline;margin-left:8px;">ä¿®æ”¹</span>
        </div>
        ${state.hotels.map((h, hi) => `
          <div class="hotel-card">
            <div class="hotel-card-header">
              <div class="hotel-location">ğŸ“ ${h.location}<span class="hotel-nights">${h.nights}æ™š</span></div>
              <div class="hotel-location-en">${h.locationEn}</div>
              <div class="hotel-dates">ğŸ“… å…¥ä½ ${h.checkIn} â†’ é€€æˆ¿ ${h.checkOut}</div>
              <div class="hotel-dates" style="opacity:0.8;">${h.note ? `ğŸ’¬ ${h.note}` : ''}</div>
            </div>
            <div class="hotel-card-body">
              <!-- Airbnb Section -->
              <div class="hotel-section">
                <div class="hotel-section-header">
                  <span class="hotel-section-title airbnb">ğŸ  Airbnb</span>
                </div>
                ${h.airbnbListUrl ? `
                  <div class="airbnb-list-link">
                    <span>ğŸ“‹</span>
                    <a href="${h.airbnbListUrl}" target="_blank">${h.airbnbListUrl}</a>
                    <button class="btn-icon edit" onclick="editAirbnbListUrl(${hi})">âœï¸</button>
                    <button class="btn-icon delete" onclick="deleteAirbnbListUrl(${hi})">ğŸ—‘ï¸</button>
                  </div>
                ` : `
                  <button class="add-option-btn airbnb" onclick="addAirbnbListUrl(${hi})" style="margin-bottom:8px;">ğŸ”— è¨­å®š Airbnb æ¸…å–®é€£çµ</button>
                `}
                ${h.airbnbs?.length ? h.airbnbs.map((opt, oi) => {
                  const price = formatPrice(opt.pricePerNight, h.nights);
                  return `
                  <div class="hotel-option airbnb ${opt.selected ? 'selected' : ''}">
                    <div class="option-number airbnb">${oi + 1}</div>
                    <div class="option-info">
                      <div class="option-name">${opt.name}</div>
                      <div class="option-price">${price.perNight}</div>
                      <div class="option-price-detail">${price.total}</div>
                      ${opt.url ? `<a href="${opt.url}" target="_blank" class="option-link">ğŸ”— æŸ¥çœ‹</a>` : ''}
                    </div>
                    <div class="option-actions">
                      <button class="btn-icon" onclick="toggleSelect(${hi}, 'airbnbs', ${oi})">${opt.selected ? 'âœ…' : 'â­•'}</button>
                      <button class="btn-icon edit" onclick="editOption(${hi}, 'airbnbs', ${oi})">âœï¸</button>
                      <button class="btn-icon delete" onclick="deleteOption(${hi}, 'airbnbs', ${oi})">ğŸ—‘ï¸</button>
                    </div>
                  </div>
                `}).join('') : ''}
                <button class="add-option-btn airbnb" onclick="addOption(${hi}, 'airbnbs')">â• æ·»åŠ  Airbnb</button>
              </div>

              <!-- Hotel Section -->
              <div class="hotel-section">
                <div class="hotel-section-header">
                  <span class="hotel-section-title hotel">ğŸ¨ é£¯åº—</span>
                </div>
                ${h.hotels?.length ? h.hotels.map((opt, oi) => {
                  const price = formatPrice(opt.pricePerNight, h.nights);
                  return `
                  <div class="hotel-option hotel-type ${opt.selected ? 'selected' : ''}">
                    <div class="option-number hotel-type">${oi + 1}</div>
                    <div class="option-info">
                      <div class="option-name">${opt.name}</div>
                      <div class="option-price">${price.perNight}</div>
                      <div class="option-price-detail">${price.total}</div>
                      ${opt.url ? `<a href="${opt.url}" target="_blank" class="option-link">ğŸ”— æŸ¥çœ‹</a>` : ''}
                    </div>
                    <div class="option-actions">
                      <button class="btn-icon" onclick="toggleSelect(${hi}, 'hotels', ${oi})">${opt.selected ? 'âœ…' : 'â­•'}</button>
                      <button class="btn-icon edit" onclick="editOption(${hi}, 'hotels', ${oi})">âœï¸</button>
                      <button class="btn-icon delete" onclick="deleteOption(${hi}, 'hotels', ${oi})">ğŸ—‘ï¸</button>
                    </div>
                  </div>
                `}).join('') : ''}
                <button class="add-option-btn hotel-type" onclick="addOption(${hi}, 'hotels')">â• æ·»åŠ é£¯åº—</button>
              </div>
            </div>
          </div>
        `).join('')}
      `;
    }

    function addAirbnbListUrl(hi) {
      openModal('ğŸ”— Airbnb æ¸…å–®é€£çµ', `
        <div class="form-group">
          <label class="form-label">Airbnb Wishlist é€£çµ</label>
          <input type="url" id="airbnb-list-url" class="form-input" placeholder="https://www.airbnb.com/wishlists/...">
          <div class="form-hint">è²¼ä¸Šä½ åœ¨ Airbnb å»ºç«‹çš„æ¸…å–®é€£çµ</div>
        </div>
        <button class="form-btn primary" onclick="saveAirbnbListUrl(${hi})">å„²å­˜</button>
      `);
    }

    function saveAirbnbListUrl(hi) {
      state.hotels[hi].airbnbListUrl = document.getElementById('airbnb-list-url').value.trim();
      save(); renderHotels(); closeModal();
    }

    function editAirbnbListUrl(hi) {
      openModal('ğŸ”— ç·¨è¼¯é€£çµ', `
        <div class="form-group">
          <label class="form-label">Airbnb Wishlist é€£çµ</label>
          <input type="url" id="airbnb-list-url" class="form-input" value="${state.hotels[hi].airbnbListUrl || ''}">
        </div>
        <button class="form-btn primary" onclick="saveAirbnbListUrl(${hi})">å„²å­˜</button>
      `);
    }

    function deleteAirbnbListUrl(hi) {
      if (confirm('åˆªé™¤é€£çµï¼Ÿ')) {
        state.hotels[hi].airbnbListUrl = '';
        save(); renderHotels();
      }
    }

    function addOption(hi, type) {
      const label = type === 'airbnbs' ? 'Airbnb' : 'é£¯åº—';
      const nights = state.hotels[hi].nights;
      openModal(`â• æ·»åŠ ${label}`, `
        <div class="form-group">
          <label class="form-label">åç¨±</label>
          <input type="text" id="opt-name" class="form-input" placeholder="${label}åç¨±">
        </div>
        <div class="form-group">
          <label class="form-label">æ¯æ™šåƒ¹æ ¼ (CHF)</label>
          <input type="number" id="opt-price" class="form-input" placeholder="150" oninput="calcTotal(${nights})">
          <div class="form-hint" id="price-calc"></div>
        </div>
        <div class="form-group">
          <label class="form-label">é€£çµ</label>
          <input type="url" id="opt-url" class="form-input" placeholder="https://...">
        </div>
        <button class="form-btn primary" onclick="saveOption(${hi}, '${type}')">ç¢ºèª</button>
      `);
    }

    function calcTotal(nights) {
      const price = parseFloat(document.getElementById('opt-price').value) || 0;
      const total = price * nights;
      const twdPerNight = Math.round(price * state.rate);
      const twdTotal = Math.round(total * state.rate);
      document.getElementById('price-calc').innerHTML = price ? 
        `æ¯æ™š NT$${twdPerNight.toLocaleString()} ï½œ ${nights}æ™šç¸½è¨ˆ CHF ${total} (NT$${twdTotal.toLocaleString()})` : '';
    }

    function saveOption(hi, type) {
      const name = document.getElementById('opt-name').value.trim();
      const pricePerNight = parseFloat(document.getElementById('opt-price').value) || 0;
      const url = document.getElementById('opt-url').value.trim();
      if (!name) return alert('è«‹å¡«å¯«åç¨±');
      if (!state.hotels[hi][type]) state.hotels[hi][type] = [];
      state.hotels[hi][type].push({ name, pricePerNight, url, selected: false });
      save(); renderHotels(); closeModal();
    }

    function editOption(hi, type, oi) {
      const opt = state.hotels[hi][type][oi];
      const label = type === 'airbnbs' ? 'Airbnb' : 'é£¯åº—';
      const nights = state.hotels[hi].nights;
      openModal(`âœï¸ ç·¨è¼¯${label}`, `
        <div class="form-group">
          <label class="form-label">åç¨±</label>
          <input type="text" id="opt-name" class="form-input" value="${opt.name}">
        </div>
        <div class="form-group">
          <label class="form-label">æ¯æ™šåƒ¹æ ¼ (CHF)</label>
          <input type="number" id="opt-price" class="form-input" value="${opt.pricePerNight || ''}" oninput="calcTotal(${nights})">
          <div class="form-hint" id="price-calc">${opt.pricePerNight ? `æ¯æ™š NT$${Math.round(opt.pricePerNight * state.rate).toLocaleString()} ï½œ ${nights}æ™šç¸½è¨ˆ CHF ${opt.pricePerNight * nights} (NT$${Math.round(opt.pricePerNight * nights * state.rate).toLocaleString()})` : ''}</div>
        </div>
        <div class="form-group">
          <label class="form-label">é€£çµ</label>
          <input type="url" id="opt-url" class="form-input" value="${opt.url || ''}">
        </div>
        <button class="form-btn primary" onclick="updateOption(${hi}, '${type}', ${oi})">å„²å­˜</button>
      `);
    }

    function updateOption(hi, type, oi) {
      const name = document.getElementById('opt-name').value.trim();
      const pricePerNight = parseFloat(document.getElementById('opt-price').value) || 0;
      const url = document.getElementById('opt-url').value.trim();
      if (!name) return alert('è«‹å¡«å¯«åç¨±');
      state.hotels[hi][type][oi] = { ...state.hotels[hi][type][oi], name, pricePerNight, url };
      save(); renderHotels(); closeModal();
    }

    function deleteOption(hi, type, oi) {
      if (confirm('åˆªé™¤ï¼Ÿ')) {
        state.hotels[hi][type].splice(oi, 1);
        save(); renderHotels();
      }
    }

    function toggleSelect(hi, type, oi) {
      state.hotels[hi][type][oi].selected = !state.hotels[hi][type][oi].selected;
      save(); renderHotels();
    }

    // Budget
    function renderBudget() {
      const total = state.budget.reduce((s, g) => s + g.items.reduce((ss, i) => ss + i.c, 0), 0);
      document.getElementById('budget-tab').innerHTML = `
        <div class="card" style="padding:16px;">
          <div class="budget-header">
            <h2 style="font-weight:600;">ğŸ’° é ç®—ï¼ˆ5äººï¼‰</h2>
            <div class="rate-badge" onclick="editRate()">âš™ï¸ 1 CHF = ${state.rate} TWD</div>
          </div>
          ${state.budget.map((g, gi) => `
            <div class="budget-cat">${g.label}</div>
            ${g.items.map((item, ii) => `
              <div class="budget-row">
                <div class="budget-item"><div class="budget-item-name">${item.n}</div>${item.note ? `<div class="budget-item-note">${item.note}</div>` : ''}</div>
                <span class="budget-chf">CHF ${item.c}</span>
                <span class="budget-twd">â‰ˆ NT$${Math.round(item.c * state.rate).toLocaleString()}</span>
                <div class="budget-actions">
                  <button class="btn-icon edit" onclick="editBudgetItem(${gi}, ${ii})">âœï¸</button>
                  <button class="btn-icon delete" onclick="deleteBudgetItem(${gi}, ${ii})">ğŸ—‘ï¸</button>
                </div>
              </div>
            `).join('')}
          `).join('')}
          <div class="budget-total">
            <span class="budget-total-label">ç¸½è¨ˆ</span>
            <div><div class="budget-total-chf">CHF ${total.toLocaleString()}</div><div class="budget-total-twd">â‰ˆ NT$ ${Math.round(total * state.rate).toLocaleString()}</div></div>
          </div>
        </div>
        <button class="add-btn" onclick="addBudgetItem()">â• æ–°å¢é …ç›®</button>
      `;
    }

    function editRate() {
      openModal('âš™ï¸ åŒ¯ç‡', `
        <div class="form-group"><label class="form-label">1 CHF = ? TWD</label><input type="number" id="rate-input" class="form-input" value="${state.rate}" step="0.1"></div>
        <button class="form-btn primary" onclick="saveRate()">å„²å­˜</button>
      `);
    }
    function saveRate() { const val = parseFloat(document.getElementById('rate-input').value); if (val > 0) { state.rate = val; save(); renderBudget(); renderHotels(); closeModal(); } }

    function addBudgetItem() {
      openModal('â• æ–°å¢', `
        <div class="form-group"><label class="form-label">é¡åˆ¥</label><select id="budget-cat" class="form-select">${state.budget.map((g, i) => `<option value="${i}">${g.label}</option>`).join('')}</select></div>
        <div class="form-group"><label class="form-label">åç¨±</label><input type="text" id="budget-name" class="form-input"></div>
        <div class="form-group"><label class="form-label">é‡‘é¡ CHF</label><input type="number" id="budget-amount" class="form-input"></div>
        <div class="form-group"><label class="form-label">å‚™è¨»</label><input type="text" id="budget-note" class="form-input"></div>
        <button class="form-btn primary" onclick="saveBudgetItem()">ç¢ºèª</button>
      `);
    }

    function saveBudgetItem() {
      const cat = parseInt(document.getElementById('budget-cat').value), name = document.getElementById('budget-name').value.trim(), amount = parseFloat(document.getElementById('budget-amount').value);
      if (!name || !amount) return alert('è«‹å¡«å¯«');
      state.budget[cat].items.push({ n: name, c: amount, note: document.getElementById('budget-note').value.trim() });
      save(); renderBudget(); closeModal();
    }

    function editBudgetItem(gi, ii) {
      const item = state.budget[gi].items[ii];
      openModal('âœï¸ ç·¨è¼¯', `
        <div class="form-group"><label class="form-label">é¡åˆ¥</label><select id="budget-cat" class="form-select">${state.budget.map((g, i) => `<option value="${i}" ${i === gi ? 'selected' : ''}>${g.label}</option>`).join('')}</select></div>
        <div class="form-group"><label class="form-label">åç¨±</label><input type="text" id="budget-name" class="form-input" value="${item.n}"></div>
        <div class="form-group"><label class="form-label">é‡‘é¡</label><input type="number" id="budget-amount" class="form-input" value="${item.c}"></div>
        <div class="form-group"><label class="form-label">å‚™è¨»</label><input type="text" id="budget-note" class="form-input" value="${item.note || ''}"></div>
        <button class="form-btn primary" onclick="updateBudgetItem(${gi}, ${ii})">å„²å­˜</button>
      `);
    }

    function updateBudgetItem(oldGi, ii) {
      const newGi = parseInt(document.getElementById('budget-cat').value), name = document.getElementById('budget-name').value.trim(), amount = parseFloat(document.getElementById('budget-amount').value);
      if (!name || !amount) return alert('è«‹å¡«å¯«');
      state.budget[oldGi].items.splice(ii, 1);
      state.budget[newGi].items.push({ n: name, c: amount, note: document.getElementById('budget-note').value.trim() });
      save(); renderBudget(); closeModal();
    }

    function deleteBudgetItem(gi, ii) { if (confirm('åˆªé™¤ï¼Ÿ')) { state.budget[gi].items.splice(ii, 1); save(); renderBudget(); } }

    // Packing
    function renderPacking() {
      const all = Object.values(state.packing).flat(), done = all.filter(i => state.checked[i]).length;
      document.getElementById('packing-tab').innerHTML = `
        <div class="packing-header">
          <div class="packing-title"><h2 style="font-weight:600;">ğŸ§³ æ‰“åŒ…æ¸…å–®</h2><div><span class="packing-count ${done === all.length ? 'done' : 'pending'}">${done}/${all.length}</span></div></div>
          <div class="progress-bar"><div class="progress-fill" style="width:${all.length ? (done/all.length)*100 : 0}%"></div></div>
        </div>
        <div class="packing-btns">
          <button class="add-btn" onclick="addPackingItem()">â• æ–°å¢</button>
          <button class="add-btn purple" onclick="addPackingCategory()">ğŸ“ åˆ†é¡</button>
        </div>
        ${Object.entries(state.packing).map(([cat, items]) => {
          const catDone = items.filter(i => state.checked[i]).length;
          return `<div class="card" style="padding:16px;">
            <div class="cat-header"><span class="cat-title">${cat}</span><div class="cat-actions"><span class="cat-count ${catDone === items.length && items.length ? 'done' : ''}">${catDone}/${items.length}</span><button class="btn-icon delete" onclick="deletePackingCategory('${cat.replace(/'/g, "\\'")}')">ğŸ—‘ï¸</button></div></div>
            ${items.map((item, idx) => `<div class="check-item ${state.checked[item] ? 'checked' : ''}" onclick="toggleCheck('${item.replace(/'/g, "\\'")}')"><div class="checkbox">${state.checked[item] ? 'âœ“' : ''}</div><span class="check-label">${item}</span><div class="check-actions" onclick="event.stopPropagation()"><button class="btn-icon edit" onclick="editPackingItem('${cat.replace(/'/g, "\\'")}', ${idx})">âœï¸</button><button class="btn-icon delete" onclick="deletePackingItem('${cat.replace(/'/g, "\\'")}', ${idx})">ğŸ—‘ï¸</button></div></div>`).join('')}
          </div>`;
        }).join('')}
        <button class="reset-btn" onclick="resetChecked()">ğŸ”„ é‡ç½®</button>
      `;
    }

    function toggleCheck(item) { state.checked[item] = !state.checked[item]; save(); renderPacking(); }
    function resetChecked() { if (confirm('é‡ç½®ï¼Ÿ')) { state.checked = {}; save(); renderPacking(); } }

    function addPackingItem() {
      openModal('â• æ–°å¢', `
        <div class="form-group"><label class="form-label">åˆ†é¡</label><select id="packing-cat" class="form-select">${Object.keys(state.packing).map(c => `<option value="${c}">${c}</option>`).join('')}</select></div>
        <div class="form-group"><label class="form-label">ç‰©å“</label><input type="text" id="packing-name" class="form-input"></div>
        <button class="form-btn primary" onclick="savePackingItem()">ç¢ºèª</button>
      `);
    }

    function savePackingItem() {
      const cat = document.getElementById('packing-cat').value, name = document.getElementById('packing-name').value.trim();
      if (!name) return alert('è«‹å¡«å¯«');
      state.packing[cat].push(name); save(); renderPacking(); closeModal();
    }

    function editPackingItem(cat, idx) {
      openModal('âœï¸ ç·¨è¼¯', `
        <div class="form-group"><label class="form-label">ç‰©å“</label><input type="text" id="packing-name" class="form-input" value="${state.packing[cat][idx]}"></div>
        <button class="form-btn primary" onclick="updatePackingItem('${cat.replace(/'/g, "\\'")}', ${idx})">å„²å­˜</button>
      `);
    }

    function updatePackingItem(cat, idx) {
      const oldName = state.packing[cat][idx], newName = document.getElementById('packing-name').value.trim();
      if (!newName) return alert('è«‹å¡«å¯«');
      state.packing[cat][idx] = newName;
      if (state.checked[oldName]) { delete state.checked[oldName]; state.checked[newName] = true; }
      save(); renderPacking(); closeModal();
    }

    function deletePackingItem(cat, idx) { if (confirm('åˆªé™¤ï¼Ÿ')) { delete state.checked[state.packing[cat][idx]]; state.packing[cat].splice(idx, 1); save(); renderPacking(); } }

    function addPackingCategory() {
      openModal('ğŸ“ æ–°å¢åˆ†é¡', `
        <div class="form-group"><label class="form-label">åç¨±</label><input type="text" id="cat-name" class="form-input" placeholder="ğŸ ä¼´æ‰‹ç¦®"></div>
        <button class="form-btn primary" onclick="savePackingCategory()">ç¢ºèª</button>
      `);
    }

    function savePackingCategory() {
      let name = document.getElementById('cat-name').value.trim();
      if (!name) return alert('è«‹å¡«å¯«');
      if (state.packing[name]) return alert('å·²å­˜åœ¨');
      state.packing[name] = []; save(); renderPacking(); closeModal();
    }

    function deletePackingCategory(cat) { if (confirm(`åˆªé™¤ã€Œ${cat}ã€ï¼Ÿ`)) { state.packing[cat].forEach(item => delete state.checked[item]); delete state.packing[cat]; save(); renderPacking(); } }

    // Files
    function renderFiles() {
      const el = document.getElementById('files-tab');
      if (!state.filesUnlocked) {
        el.innerHTML = `<div class="lock-screen"><div class="lock-icon">ğŸ”’</div><div class="lock-title">æ–‡ä»¶å·²åŠ å¯†</div><div class="lock-desc">è«‹è¼¸å…¥å¯†ç¢¼</div><input type="password" id="file-password" class="password-input" maxlength="6"><br><button class="unlock-btn" onclick="unlockFiles()">ğŸ”“ è§£é–</button><div id="password-error" class="error-msg hidden"></div></div>`;
        setTimeout(() => { const input = document.getElementById('file-password'); if (input) input.addEventListener('keypress', e => { if (e.key === 'Enter') unlockFiles(); }); }, 100);
        return;
      }

      const grouped = {}; state.fileCategories.forEach(cat => grouped[cat] = []);
      state.files.forEach(f => { if (!grouped[f.category]) grouped[f.category] = []; grouped[f.category].push(f); });

      el.innerHTML = `
        <div class="upload-zone" onclick="document.getElementById('file-input').click()">
          <div class="upload-icon">ğŸ“¤</div><div class="upload-text">é»æ“Šä¸Šå‚³</div><div class="upload-hint">PDF, JPG, PNG (max 5MB)</div>
          <input type="file" id="file-input" accept=".pdf,.jpg,.jpeg,.png" multiple style="display:none" onchange="handleFileUpload(event)">
        </div>
        <div class="packing-btns">
          <button class="add-btn purple" onclick="addFileCategory()">ğŸ“ åˆ†é¡</button>
          <button class="add-btn" style="background:#ef4444;" onclick="lockFiles()">ğŸ”’ é–å®š</button>
        </div>
        ${state.fileCategories.map(cat => `
          <div class="file-category">
            <div class="file-cat-header"><span class="file-cat-name">ğŸ“ ${cat}</span><div class="cat-actions"><span class="file-cat-count">${grouped[cat]?.length || 0}</span><button class="btn-icon delete" onclick="deleteFileCategory('${cat.replace(/'/g, "\\'")}')">ğŸ—‘ï¸</button></div></div>
            ${grouped[cat]?.length ? grouped[cat].map((f, idx) => `<div class="file-item"><span class="file-icon">${f.type === 'application/pdf' ? 'ğŸ“„' : 'ğŸ–¼ï¸'}</span><div class="file-info"><div class="file-name">${f.name}</div><div class="file-meta">${f.uploadDate}</div></div><div class="file-actions"><button class="btn-icon" onclick="viewFile(${state.files.indexOf(f)})">ğŸ‘ï¸</button><button class="btn-icon edit" onclick="editFile(${state.files.indexOf(f)})">âœï¸</button><button class="btn-icon delete" onclick="deleteFile(${state.files.indexOf(f)})">ğŸ—‘ï¸</button></div></div>`).join('') : '<div class="no-options">ç„¡æª”æ¡ˆ</div>'}
          </div>
        `).join('')}
      `;
    }

    function unlockFiles() {
      const input = document.getElementById('file-password'), error = document.getElementById('password-error');
      if (input.value === FILE_PASSWORD) { state.filesUnlocked = true; renderFiles(); }
      else { error.textContent = 'å¯†ç¢¼éŒ¯èª¤'; error.classList.remove('hidden'); input.value = ''; }
    }

    function lockFiles() { state.filesUnlocked = false; renderFiles(); }

    function handleFileUpload(event) {
      Array.from(event.target.files).forEach(file => {
        if (file.size > 5 * 1024 * 1024) { alert('è¶…é5MB'); return; }
        const reader = new FileReader();
        reader.onload = e => {
          openModal('ğŸ“¤ ä¸Šå‚³', `
            <div class="form-group"><label class="form-label">åç¨±</label><input type="text" id="file-name" class="form-input" value="${file.name}"></div>
            <div class="form-group"><label class="form-label">åˆ†é¡</label><select id="file-category" class="form-select">${state.fileCategories.map(c => `<option value="${c}">${c}</option>`).join('')}</select></div>
            <button class="form-btn primary" onclick="saveFile('${e.target.result.replace(/'/g, "\\'")}', '${file.type}', ${file.size})">ä¸Šå‚³</button>
          `);
        };
        reader.readAsDataURL(file);
      });
    }

    function saveFile(data, type, size) {
      const name = document.getElementById('file-name').value.trim();
      if (!name) return alert('è«‹å¡«å¯«');
      state.files.push({ name, category: document.getElementById('file-category').value, type, size, data, uploadDate: new Date().toLocaleDateString('zh-TW') });
      save(); renderFiles(); closeModal();
    }

    function viewFile(idx) {
      const f = state.files[idx], win = window.open();
      win.document.write(f.type === 'application/pdf' ? `<iframe src="${f.data}" style="width:100%;height:100%;border:none;"></iframe>` : `<img src="${f.data}" style="max-width:100%;">`);
    }

    function editFile(idx) {
      const f = state.files[idx];
      openModal('âœï¸ ç·¨è¼¯', `
        <div class="form-group"><label class="form-label">åç¨±</label><input type="text" id="file-name" class="form-input" value="${f.name}"></div>
        <div class="form-group"><label class="form-label">åˆ†é¡</label><select id="file-category" class="form-select">${state.fileCategories.map(c => `<option value="${c}" ${c === f.category ? 'selected' : ''}>${c}</option>`).join('')}</select></div>
        <button class="form-btn primary" onclick="updateFile(${idx})">å„²å­˜</button>
      `);
    }

    function updateFile(idx) { state.files[idx].name = document.getElementById('file-name').value.trim(); state.files[idx].category = document.getElementById('file-category').value; save(); renderFiles(); closeModal(); }
    function deleteFile(idx) { if (confirm('åˆªé™¤ï¼Ÿ')) { state.files.splice(idx, 1); save(); renderFiles(); } }

    function addFileCategory() {
      openModal('ğŸ“ æ–°å¢', `<div class="form-group"><label class="form-label">åç¨±</label><input type="text" id="cat-name" class="form-input"></div><button class="form-btn primary" onclick="saveFileCategory()">ç¢ºèª</button>`);
    }

    function saveFileCategory() {
      const name = document.getElementById('cat-name').value.trim();
      if (!name || state.fileCategories.includes(name)) return alert('ç„¡æ•ˆ');
      state.fileCategories.push(name); save(); renderFiles(); closeModal();
    }

    function deleteFileCategory(cat) {
      if (state.files.some(f => f.category === cat) && !confirm('æœ‰æª”æ¡ˆæœƒç§»è‡³å…¶ä»–ï¼Ÿ')) return;
      state.files.forEach(f => { if (f.category === cat) f.category = 'å…¶ä»–'; });
      state.fileCategories = state.fileCategories.filter(c => c !== cat);
      save(); renderFiles();
    }

    // Tabs
    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
      ['itinerary', 'hotel', 'budget', 'packing', 'files'].forEach(id => document.getElementById(`${id}-tab`).classList.toggle('hidden', id !== tabId));
      if (tabId === 'files') renderFiles();
      if (tabId === 'hotel') renderHotels();
    }

    document.querySelectorAll('.tab').forEach(tab => tab.addEventListener('click', () => switchTab(tab.dataset.tab)));
    document.getElementById('modal').addEventListener('click', function(e) { if (e.target === this) closeModal(); });

    renderItinerary(); renderHotels(); renderBudget(); renderPacking(); renderFiles();
  </script>
</body>
</html>