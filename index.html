<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>ğŸ‡¨ğŸ‡­ ç‘å£«ä¹‹æ—… 2026</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‡¨ğŸ‡­</text></svg>">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif; background: linear-gradient(to bottom, #fef2f2, #fff); min-height: 100vh; }
    .header { background: linear-gradient(to right, #dc2626, #b91c1c); color: #fff; padding: 20px; border-radius: 0 0 24px 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .header h1 { font-size: 1.25rem; display: flex; align-items: center; gap: 8px; }
    .header p { color: #fecaca; font-size: 0.875rem; margin-top: 4px; }
    .tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    .tag { background: rgba(255,255,255,0.2); padding: 2px 10px; border-radius: 20px; font-size: 0.75rem; }
    .tabs { display: flex; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
    .tab { flex: 1; padding: 10px 4px; border: none; background: none; cursor: pointer; font-size: 0.7rem; color: #6b7280; display: flex; flex-direction: column; align-items: center; gap: 2px; transition: all 0.2s; }
    .tab.active { color: #dc2626; border-bottom: 2px solid #dc2626; }
    .tab-icon { font-size: 1.125rem; }
    .content { padding: 16px; padding-bottom: 80px; max-width: 500px; margin: 0 auto; }
    .card { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 12px; overflow: hidden; }
    .card.highlight { box-shadow: 0 0 0 2px #ef4444, 0 2px 8px rgba(0,0,0,0.08); }
    .card.family { background: #fffbeb; }
    .day-header { width: 100%; padding: 16px; display: flex; align-items: center; justify-content: space-between; border: none; background: none; cursor: pointer; text-align: left; }
    .day-header:hover { background: #f9fafb; }
    .day-left { display: flex; align-items: center; gap: 12px; }
    .day-icon { font-size: 1.75rem; }
    .day-date { font-size: 0.75rem; color: #6b7280; }
    .day-title { font-weight: 600; color: #1f2937; }
    .day-loc { font-size: 0.75rem; color: #dc2626; }
    .day-right { display: flex; align-items: center; gap: 8px; }
    .badge { font-size: 0.625rem; padding: 2px 8px; border-radius: 20px; }
    .badge-family { background: #fde68a; color: #92400e; }
    .badge-highlight { background: #fee2e2; color: #dc2626; }
    .badge-first { background: #dbeafe; color: #1e40af; }
    .arrow { color: #9ca3af; font-size: 0.875rem; }
    .day-content { padding: 0 16px 16px; border-top: 1px solid #f3f4f6; display: none; }
    .day-content.open { display: block; }
    .hotel-box { margin-top: 12px; padding: 12px; background: #eff6ff; border-radius: 8px; display: flex; align-items: center; gap: 8px; font-size: 0.875rem; }
    .schedule { margin-top: 12px; }
    .schedule-item { display: flex; gap: 12px; padding: 8px 0; font-size: 0.875rem; }
    .schedule-time { width: 48px; color: #dc2626; font-family: monospace; font-weight: 500; flex-shrink: 0; }
    .schedule-activity { flex: 1; color: #374151; }
    .schedule-duration { font-size: 0.75rem; color: #9ca3af; margin-top: 2px; }
    .map-btn { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 12px; background: #16a34a; color: #fff; border: none; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; margin-top: 16px; text-decoration: none; }
    .map-btn:hover { background: #15803d; }
    .section-title { font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .route-item { display: flex; align-items: center; gap: 8px; padding: 8px 0; font-size: 0.875rem; }
    .route-dot { width: 12px; height: 12px; background: #ef4444; border-radius: 50%; }
    .price-row { display: flex; justify-content: space-between; padding: 10px 12px; font-size: 0.875rem; border-radius: 8px; margin-bottom: 8px; }
    .price-row.recommended { background: #f0fdf4; }
    .price-row.normal { background: #f9fafb; }
    .price-value { font-weight: 600; }
    .price-value.green { color: #16a34a; }
    .tip-box { background: #fffbeb; padding: 16px; border-radius: 12px; }
    .tip-box h3 { font-size: 0.875rem; margin-bottom: 8px; }
    .tip-box li { font-size: 0.875rem; color: #374151; margin-left: 16px; margin-bottom: 4px; }
    .budget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 8px; }
    .rate-badge { font-size: 0.75rem; background: #f3f4f6; padding: 6px 12px; border-radius: 20px; cursor: pointer; display: flex; align-items: center; gap: 4px; }
    .rate-badge:hover { background: #e5e7eb; }
    .budget-cat { font-weight: 500; color: #374151; margin: 16px 0 8px; }
    .budget-row { display: flex; align-items: center; padding: 10px 0 10px 12px; border-bottom: 1px solid #f3f4f6; font-size: 0.875rem; gap: 8px; }
    .budget-row:hover { background: #f9fafb; }
    .budget-item { flex: 1; color: #4b5563; min-width: 0; }
    .budget-item-name { word-break: break-word; }
    .budget-item-note { font-size: 0.75rem; color: #9ca3af; margin-top: 2px; }
    .budget-chf { width: 70px; text-align: right; flex-shrink: 0; }
    .budget-twd { width: 90px; text-align: right; color: #9ca3af; flex-shrink: 0; font-size: 0.8rem; }
    .budget-actions { display: flex; gap: 4px; opacity: 0; transition: opacity 0.2s; }
    .budget-row:hover .budget-actions { opacity: 1; }
    .btn-icon { width: 28px; height: 28px; border: none; background: none; cursor: pointer; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; }
    .btn-icon:hover { background: #e5e7eb; }
    .btn-icon.edit { color: #3b82f6; }
    .btn-icon.delete { color: #ef4444; }
    .budget-total { border-top: 2px solid #fecaca; padding-top: 16px; margin-top: 16px; display: flex; justify-content: space-between; align-items: center; }
    .budget-total-label { font-weight: 600; }
    .budget-total-value { text-align: right; }
    .budget-total-chf { font-size: 1.25rem; font-weight: 700; color: #dc2626; }
    .budget-total-twd { font-size: 0.875rem; color: #6b7280; }
    .info-box { background: #eff6ff; padding: 16px; border-radius: 12px; font-size: 0.875rem; color: #1e40af; margin-top: 16px; }
    .add-btn { width: 100%; padding: 14px; background: #3b82f6; color: #fff; border: none; border-radius: 12px; font-size: 0.875rem; font-weight: 500; cursor: pointer; margin-top: 12px; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .add-btn:hover { background: #2563eb; }
    .add-btn.purple { background: #8b5cf6; }
    .add-btn.purple:hover { background: #7c3aed; }
    .add-btn.green { background: #16a34a; }
    .add-btn.green:hover { background: #15803d; }
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 200; padding: 16px; }
    .modal.hidden { display: none; }
    .modal-content { background: #fff; border-radius: 16px; padding: 20px; width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .modal-title { font-weight: 600; font-size: 1.125rem; }
    .modal-close { width: 32px; height: 32px; border: none; background: #f3f4f6; border-radius: 8px; cursor: pointer; font-size: 1.25rem; display: flex; align-items: center; justify-content: center; }
    .modal-close:hover { background: #e5e7eb; }
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 0.75rem; color: #6b7280; margin-bottom: 6px; }
    .form-input, .form-select { width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 0.875rem; }
    .form-input:focus, .form-select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
    .form-hint { font-size: 0.75rem; color: #9ca3af; margin-top: 4px; }
    .form-btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; }
    .form-btn.primary { background: #22c55e; color: #fff; }
    .form-btn.primary:hover { background: #16a34a; }
    .form-btn.secondary { background: #e5e7eb; color: #374151; margin-top: 8px; }
    .form-btn.secondary:hover { background: #d1d5db; }
    .packing-header { background: #fff; border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); position: sticky; top: 52px; z-index: 50; margin-bottom: 16px; }
    .packing-title { display: flex; justify-content: space-between; align-items: center; }
    .packing-count { font-size: 1.125rem; font-weight: 700; }
    .packing-count.done { color: #16a34a; }
    .packing-count.pending { color: #dc2626; }
    .packing-subtitle { font-size: 0.75rem; color: #6b7280; }
    .progress-bar { height: 12px; background: #e5e7eb; border-radius: 6px; margin-top: 12px; overflow: hidden; }
    .progress-fill { height: 100%; background: #22c55e; transition: width 0.3s; }
    .packing-btns { display: flex; gap: 8px; margin-bottom: 16px; }
    .packing-btns .add-btn { flex: 1; margin: 0; padding: 10px; font-size: 0.8rem; }
    .cat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .cat-title { font-weight: 600; }
    .cat-actions { display: flex; align-items: center; gap: 8px; }
    .cat-count { font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; background: #f3f4f6; }
    .cat-count.done { background: #dcfce7; color: #16a34a; }
    .check-item { display: flex; align-items: center; gap: 12px; padding: 10px 8px; border-radius: 8px; cursor: pointer; transition: background 0.2s; }
    .check-item:hover { background: #f9fafb; }
    .check-item.checked { background: #f0fdf4; }
    .checkbox { width: 24px; height: 24px; border: 2px solid #d1d5db; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
    .check-item.checked .checkbox { background: #22c55e; border-color: #22c55e; color: #fff; }
    .check-label { font-size: 0.875rem; color: #374151; flex: 1; }
    .check-item.checked .check-label { color: #9ca3af; text-decoration: line-through; }
    .check-actions { display: flex; gap: 2px; opacity: 0; transition: opacity 0.2s; }
    .check-item:hover .check-actions { opacity: 1; }
    .reset-btn { width: 100%; padding: 14px; background: #e5e7eb; color: #4b5563; border: none; border-radius: 12px; font-size: 0.875rem; font-weight: 500; cursor: pointer; margin-top: 16px; }
    .reset-btn:hover { background: #d1d5db; }
    .footer { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; border-top: 1px solid #e5e7eb; padding: 12px; text-align: center; font-size: 0.75rem; color: #6b7280; }
    .hidden { display: none !important; }
    .route-section { background: #f9fafb; padding: 12px; border-radius: 8px; margin-top: 12px; }
    .route-section h4 { font-size: 0.875rem; margin-bottom: 8px; color: #374151; }
    .booking-info { background: #dbeafe; padding: 12px; border-radius: 8px; margin-top: 12px; font-size: 0.8rem; }
    .booking-info div { margin-bottom: 4px; }
    .booking-info strong { color: #1e40af; }
    /* Files tab */
    .lock-screen { text-align: center; padding: 60px 20px; }
    .lock-icon { font-size: 4rem; margin-bottom: 16px; }
    .lock-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 8px; }
    .lock-desc { color: #6b7280; font-size: 0.875rem; margin-bottom: 24px; }
    .password-input { width: 200px; padding: 12px 16px; border: 2px solid #d1d5db; border-radius: 12px; font-size: 1.25rem; text-align: center; letter-spacing: 8px; }
    .password-input:focus { outline: none; border-color: #3b82f6; }
    .unlock-btn { margin-top: 16px; padding: 12px 32px; background: #3b82f6; color: #fff; border: none; border-radius: 12px; font-size: 1rem; font-weight: 500; cursor: pointer; }
    .unlock-btn:hover { background: #2563eb; }
    .error-msg { color: #dc2626; font-size: 0.875rem; margin-top: 12px; }
    .file-category { margin-bottom: 20px; }
    .file-cat-header { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f3f4f6; border-radius: 8px; margin-bottom: 8px; }
    .file-cat-name { font-weight: 600; display: flex; align-items: center; gap: 8px; }
    .file-cat-count { font-size: 0.75rem; color: #6b7280; }
    .file-item { display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 8px; }
    .file-item:hover { background: #f9fafb; }
    .file-icon { font-size: 1.5rem; }
    .file-info { flex: 1; min-width: 0; }
    .file-name { font-weight: 500; font-size: 0.875rem; word-break: break-word; }
    .file-meta { font-size: 0.75rem; color: #9ca3af; }
    .file-actions { display: flex; gap: 4px; }
    .upload-zone { border: 2px dashed #d1d5db; border-radius: 12px; padding: 32px; text-align: center; cursor: pointer; transition: all 0.2s; margin-bottom: 16px; }
    .upload-zone:hover { border-color: #3b82f6; background: #eff6ff; }
    .upload-zone.dragover { border-color: #3b82f6; background: #dbeafe; }
    .upload-icon { font-size: 2.5rem; margin-bottom: 8px; }
    .upload-text { color: #6b7280; font-size: 0.875rem; }
    .upload-hint { color: #9ca3af; font-size: 0.75rem; margin-top: 4px; }
    @media (max-width: 400px) {
      .budget-twd { display: none; }
      .budget-actions { opacity: 1; }
      .check-actions { opacity: 1; }
      .file-actions { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1><span>ğŸ‡¨ğŸ‡­</span> ç‘å£«ä¹‹æ—… 2026</h1>
    <p>2/7 - 2/20 ï½œ14å¤©ï½œ5äºº</p>
    <div class="tags">
      <span class="tag">å†°å·åˆ—è»Š ğŸš‚</span>
      <span class="tag">é¦¬ç‰¹æ´ªå³°</span>
      <span class="tag">å°‘å¥³å³°</span>
      <span class="tag">åˆ—æ”¯æ•¦å£«ç™»</span>
    </div>
  </div>

  <div class="tabs">
    <button class="tab active" data-tab="itinerary"><span class="tab-icon">ğŸ“…</span>è¡Œç¨‹</button>
    <button class="tab" data-tab="glacier"><span class="tab-icon">ğŸš‚</span>å†°å·</button>
    <button class="tab" data-tab="budget"><span class="tab-icon">ğŸ’°</span>é ç®—</button>
    <button class="tab" data-tab="packing"><span class="tab-icon">ğŸ§³</span>æ‰“åŒ…</button>
    <button class="tab" data-tab="files"><span class="tab-icon">ğŸ“</span>æ–‡ä»¶</button>
  </div>

  <div class="content">
    <div id="itinerary-tab"></div>
    <div id="glacier-tab" class="hidden"></div>
    <div id="budget-tab" class="hidden"></div>
    <div id="packing-tab" class="hidden"></div>
    <div id="files-tab" class="hidden"></div>
  </div>

  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title" id="modal-title">æ–°å¢</span>
        <button class="modal-close" onclick="closeModal()">Ã—</button>
      </div>
      <div id="modal-body"></div>
    </div>
  </div>

  <div class="footer">ğŸ‡¨ğŸ‡­ ç‘å£«ä¹‹æ—… 2026 ï½œæƒ…äººç¯€å¿«æ¨‚ â¤ï¸</div>

  <script>
    const DEFAULT_DATA = {
      itinerary: [
        { date: '2/7 (å…­)', title: 'EvaæŠµé”è˜‡é»ä¸–', icon: 'âœˆï¸', loc: 'è˜‡é»ä¸–', schedule: [
          { t: '12:00', a: 'âœˆï¸ å¾è‹±åœ‹å‡ºç™¼', d: '1h45m' }, { t: '15:00', a: 'æŠµé”è˜‡é»ä¸–æ©Ÿå ´', d: '-' },
          { t: '15:30', a: 'æ­ç«è»Šè‡³å¸‚å€', d: '15m' }, { t: '16:00', a: 'å…¥ä½é…’åº—', d: '1h' },
          { t: '17:00', a: 'ç­éœå¤«å¤§è¡—è³¼ç‰©', d: '1.5h' }, { t: '18:30', a: 'å¤§æ•™å ‚ GrossmÃ¼nster', d: '30m' },
          { t: '19:00', a: 'æ—ç™»éœå¤«å±±ä¸˜', d: '30m' }, { t: '20:00', a: 'è€åŸæ™šé¤', d: '1.5h' }
        ], map: ['Zurich Airport', 'Zurich HB', 'Bahnhofstrasse Zurich', 'Grossmunster Zurich'], route: 'è‹±åœ‹ âœˆï¸ â†’ è˜‡é»ä¸–' },
        { date: '2/8 (æ—¥)', title: 'å®¶äººæŠµé”ãƒ»æœƒåˆï¼', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', loc: 'è˜‡é»ä¸–', hl: true, schedule: [
          { t: '07:30', a: 'ğŸ›¬ å®¶äººæŠµé”è˜‡é»ä¸–æ©Ÿå ´', d: '-' }, { t: '08:30', a: 'æ¥æ©Ÿãƒ»æ—©é¤', d: '1.5h' },
          { t: '10:00', a: 'ç«è»Šè‡³å¸‚å€ãƒ»å¯„æ”¾è¡Œæ', d: '30m' }, { t: '10:30', a: 'é…’åº—ä¼‘æ¯èª¿æ™‚å·®', d: '2h' },
          { t: '13:00', a: 'åˆé¤ Zeughauskeller', d: '1h' }, { t: '14:30', a: 'è˜‡é»ä¸–æ¹–ç•”æ•£æ­¥', d: '1.5h' },
          { t: '16:00', a: 'SprÃ¼ngli å·§å…‹åŠ›åº—', d: '30m' }, { t: '17:00', a: 'è€åŸæ¼«æ­¥', d: '2h' }
        ], map: ['Zurich Airport', 'Zurich HB', 'Zeughauskeller Zurich', 'Lake Zurich'], route: 'å°ç£ âœˆï¸ â†’ è˜‡é»ä¸–' },
        { date: '2/9 (ä¸€)', title: 'ğŸ‡±ğŸ‡® åˆ—æ”¯æ•¦å£«ç™»', icon: 'ğŸ°', loc: 'ç“¦æœèŒ²', schedule: [
          { t: '08:30', a: 'ğŸš‚ è˜‡é»ä¸–å‡ºç™¼', d: '1h' }, { t: '09:30', a: 'Sargans è½‰è»Š', d: '15m' },
          { t: '10:00', a: 'ğŸšŒ æŠµé”ç“¦æœèŒ²', d: '-' }, { t: '10:30', a: 'è­·ç…§è“‹ç´€å¿µç«  CHF3', d: '30m' },
          { t: '11:00', a: 'ç“¦æœèŒ²åŸå ¡(å¤–è§€)', d: '1h' }, { t: '12:00', a: 'åˆé¤', d: '1h' },
          { t: '13:30', a: 'è—è¡“åšç‰©é¤¨', d: '1.5h' }, { t: '15:00', a: 'ç‹å®¤é…’èŠå“é…’', d: '1h' },
          { t: '17:00', a: 'ğŸšŒğŸš‚ è¿”å›è˜‡é»ä¸–', d: '1.5h' }
        ], map: ['Zurich HB', 'Sargans Station', 'Vaduz Liechtenstein', 'Vaduz Castle'], route: 'è˜‡é»ä¸– ğŸš‚ â†’ Sargans ğŸšŒ â†’ ç“¦æœèŒ² â†’ è˜‡é»ä¸–' },
        { date: '2/10 (äºŒ)', title: 'ç‰æ£®', icon: 'ğŸ¦', loc: 'ç‰æ£®', schedule: [
          { t: '09:00', a: 'ğŸš‚ è˜‡é»ä¸–â†’ç‰æ£®', d: '45m' }, { t: '10:00', a: 'ç…å­ç´€å¿µç¢‘', d: '30m' },
          { t: '10:45', a: 'å†°æ²³å…¬åœ’', d: '1h' }, { t: '12:00', a: 'åˆé¤', d: '1h' },
          { t: '13:30', a: 'å¡è²çˆ¾æ©‹', d: '30m' }, { t: '14:00', a: 'è€åŸæ¼«æ­¥', d: '2h' },
          { t: '16:00', a: 'å¤©éµå»£å ´è³¼ç‰©', d: '1.5h' }, { t: '18:00', a: 'æ¹–ç•”æ™šé¤', d: '2h' }
        ], map: ['Zurich HB', 'Luzern Station', 'Lion Monument Luzern', 'Chapel Bridge Luzern'], route: 'è˜‡é»ä¸– ğŸš‚ â†’ ç‰æ£® â†’ è˜‡é»ä¸–' },
        { date: '2/11 (ä¸‰)', title: 'å‰å¾€è–è«é‡ŒèŒ²', icon: 'ğŸ¿', loc: 'è–è«é‡ŒèŒ²', schedule: [
          { t: '08:00', a: 'æ—©é¤ãƒ»é€€æˆ¿', d: '1h' }, { t: '09:00', a: 'ğŸš‚ è˜‡é»ä¸–â†’è–è«é‡ŒèŒ²', d: '3h' },
          { t: '12:00', a: 'æŠµé”è–è«é‡ŒèŒ²ãƒ»å…¥ä½', d: '1h' }, { t: '13:00', a: 'åˆé¤', d: '1h' },
          { t: '14:30', a: 'è–è«é‡ŒèŒ²æ¹–æ•£æ­¥', d: '1.5h' }, { t: '16:00', a: 'å°é®è³¼ç‰© Via Serlas', d: '1.5h' },
          { t: '18:00', a: 'ç‘å£«å‚³çµ±æ™šé¤', d: '2h' }, { t: '20:30', a: 'æ—©ç¡ï¼ˆæ˜å¤©å†°å·åˆ—è»Šï¼‰', d: '-' }
        ], map: ['Zurich HB', 'Chur Station', 'St Moritz', 'St Moritz Lake'], route: 'è˜‡é»ä¸– ğŸš‚ â†’ Chur â†’ è–è«é‡ŒèŒ²ï¼ˆ3å°æ™‚ï¼‰' },
        { date: '2/12 (å››)', title: 'ğŸš‚ å†°å·åˆ—è»Š', icon: 'ğŸš‚', loc: 'é‡‡çˆ¾é¦¬ç‰¹', hl: true, first: true, schedule: [
          { t: '07:00', a: 'æ—©é¤ãƒ»é€€æˆ¿', d: '1h' }, { t: '08:38', a: 'ğŸš‚ å†°å·åˆ—è»Šå‡ºç™¼ï¼', d: '8h30m' },
          { t: '10:00', a: 'ğŸ“¸ è˜­å¾·ç“¦ç‘Ÿé«˜æ¶æ©‹', d: '-' }, { t: '12:00', a: 'ğŸ½ï¸ è»Šä¸Š2é“å¼åˆé¤', d: '1.5h' },
          { t: '14:00', a: 'â›°ï¸ ä¸Šé˜¿çˆ¾å‘æ–¯å±±å£ 2,033m', d: '-' }, { t: '17:07', a: 'æŠµé”é‡‡çˆ¾é¦¬ç‰¹', d: '-' },
          { t: '17:30', a: 'å…¥ä½é…’åº—', d: '30m' }, { t: '18:00', a: 'å°é®æ¼«æ­¥', d: '1h' },
          { t: '19:30', a: 'æ™šé¤', d: '2h' }
        ], map: ['St Moritz Station', 'Zermatt'], route: 'è–è«é‡ŒèŒ² ğŸš‚ â†’ é‡‡çˆ¾é¦¬ç‰¹ï¼ˆå†°å·åˆ—è»Š 8h30mï¼‰',
        booking: { train: '903', car: '24', seats: '21-22, 24-26', class: 'é ­ç­‰è‰™', meal: '2é“å¼åˆé¤(è‚‰)x5', price: 'CHF 210' } },
        { date: '2/13 (äº”)', title: 'é¦¬ç‰¹æ´ªå³°', icon: 'ğŸ”ï¸', loc: 'é‡‡çˆ¾é¦¬ç‰¹', schedule: [
          { t: '08:00', a: 'æ—©é¤', d: '1h' }, { t: '09:00', a: 'ğŸš‚ Gornergrat ç™»å±±éµè·¯', d: '33m' },
          { t: '09:45', a: 'æŠµé” Gornergrat 3,089m', d: '-' }, { t: '10:00', a: 'é¦¬ç‰¹æ´ªå³°è§€æ™¯ãƒ»æ‹ç…§', d: '2h' },
          { t: '12:00', a: 'å±±é ‚åˆé¤', d: '1h' }, { t: '13:30', a: 'ä¸‹å±±ãƒ»ä¸­é€”ç«™å¥è¡Œ', d: '2h' },
          { t: '16:00', a: 'è¿”å›é‡‡çˆ¾é¦¬ç‰¹', d: '-' }, { t: '17:00', a: 'å°é®è³¼ç‰©', d: '2h' },
          { t: '19:30', a: 'æ™šé¤', d: '2h' }
        ], map: ['Zermatt', 'Gornergrat Bahn Zermatt', 'Gornergrat'], route: 'é‡‡çˆ¾é¦¬ç‰¹ ğŸš‚ â†’ Gornergrat â†’ é‡‡çˆ¾é¦¬ç‰¹' },
        { date: '2/14 (å…­)', title: 'â¤ï¸ æƒ…äººç¯€', icon: 'â¤ï¸', loc: 'é‡‡çˆ¾é¦¬ç‰¹', hl: true, schedule: [
          { t: '09:00', a: 'ç¡åˆ°è‡ªç„¶é†’ãƒ»æ—©åˆé¤', d: '2h' }, { t: '11:00', a: 'Sunnegga çºœè»Š', d: '3m' },
          { t: '11:30', a: 'é¦¬ç‰¹æ´ªå³°æ‹ç…§é»', d: '1.5h' }, { t: '13:00', a: 'å±±ä¸Šåˆé¤', d: '1h' },
          { t: '14:30', a: 'ä¸‹å±±', d: '-' }, { t: '15:00', a: 'é‡‡çˆ¾é¦¬ç‰¹å°é®æ¼«æ­¥', d: '2h' },
          { t: '17:00', a: 'Spa / ä¼‘æ¯', d: '2h' }, { t: '19:30', a: 'â¤ï¸ æƒ…äººç¯€æ™šé¤', d: '2.5h' }
        ], map: ['Zermatt', 'Sunnegga Zermatt'], route: 'é‡‡çˆ¾é¦¬ç‰¹ ğŸš¡ â†’ Sunnegga â†’ é‡‡çˆ¾é¦¬ç‰¹' },
        { date: '2/15 (æ—¥)', title: 'å‰å¾€å› ç‰¹æ‹‰è‚¯', icon: 'ğŸ”ï¸', loc: 'å› ç‰¹æ‹‰è‚¯', schedule: [
          { t: '08:00', a: 'æ—©é¤ãƒ»é€€æˆ¿', d: '1h' }, { t: '09:15', a: 'ğŸš‚ é‡‡çˆ¾é¦¬ç‰¹â†’å› ç‰¹æ‹‰è‚¯', d: '2h30m' },
          { t: '11:45', a: 'æŠµé”å› ç‰¹æ‹‰è‚¯ãƒ»å…¥ä½', d: '1h' }, { t: '13:00', a: 'åˆé¤', d: '1h' },
          { t: '14:30', a: 'å› ç‰¹æ‹‰è‚¯å°é®æ¼«æ­¥', d: '2h' }, { t: '16:30', a: 'HÃ¶heweg å¤§é“', d: '1h' },
          { t: '18:00', a: 'æ¹–ç•”æ•£æ­¥', d: '1h' }, { t: '19:30', a: 'æ™šé¤', d: '2h' }
        ], map: ['Zermatt', 'Visp', 'Spiez', 'Interlaken Ost'], route: 'é‡‡çˆ¾é¦¬ç‰¹ ğŸš‚ â†’ Visp â†’ Spiez â†’ å› ç‰¹æ‹‰è‚¯ï¼ˆ2.5å°æ™‚ï¼‰' },
        { date: '2/16 (ä¸€)', title: 'â­ å°‘å¥³å³° Top of Europe', icon: 'ğŸ—»', loc: 'å°‘å¥³å³°', hl: true, schedule: [
          { t: '07:30', a: 'æ—©é¤', d: '30m' }, { t: '08:30', a: 'ğŸš¡ Eiger Express çºœè»Š', d: '15m' },
          { t: '09:00', a: 'ğŸš‚ å°‘å¥³å³°éµè·¯', d: '30m' }, { t: '09:30', a: 'æŠµé”å°‘å¥³å³°ç«™ 3,454m', d: '-' },
          { t: '10:00', a: 'æ–¯èŠ¬å…‹æ–¯è§€æ™¯å°', d: '1h' }, { t: '11:00', a: 'å†°å®® Ice Palace', d: '45m' },
          { t: '12:00', a: 'å±±é ‚åˆé¤', d: '1h' }, { t: '13:00', a: 'é›ªåœ°æ´»å‹•/æ‹ç…§', d: '2h' },
          { t: '15:30', a: 'ä¸‹å±±è¿”å›å› ç‰¹æ‹‰è‚¯', d: '1h' }, { t: '17:00', a: 'ä¼‘æ¯ãƒ»æº–å‚™æ˜å¤©', d: '-' }
        ], map: ['Interlaken Ost', 'Grindelwald Terminal', 'Eigergletscher', 'Jungfraujoch'], route: 'å› ç‰¹æ‹‰è‚¯ ğŸš‚ â†’ Grindelwald ğŸš¡ â†’ å°‘å¥³å³°' },
        { date: '2/17 (äºŒ)', title: 'Evaè¿”å›è‹±åœ‹', icon: 'âœˆï¸', loc: 'æ—¥å…§ç“¦', schedule: [
          { t: '07:30', a: 'æ—©é¤ãƒ»é€€æˆ¿', d: '1h' }, { t: '08:30', a: 'ğŸš‚ å› ç‰¹æ‹‰è‚¯â†’æ—¥å…§ç“¦', d: '2h45m' },
          { t: '11:15', a: 'æŠµé”æ—¥å…§ç“¦', d: '-' }, { t: '11:30', a: 'è¡Œæå¯„å­˜ãƒ»å‘Šåˆ¥', d: '30m' },
          { t: '12:00', a: 'âœˆï¸ Evaå‰å¾€æ©Ÿå ´', d: '20m' }, { t: '14:00', a: 'âœˆï¸ Evaé£›å›è‹±åœ‹', d: '1h45m' },
          { t: '---', a: 'â”€â”€â”€ å®¶äººè¡Œç¨‹ â”€â”€â”€', d: '-' },
          { t: '12:00', a: 'å…¥ä½é…’åº—ãƒ»åˆé¤', d: '1.5h' }, { t: '14:00', a: 'å¤§å™´æ³‰ Jet d\'Eau', d: '30m' },
          { t: '15:00', a: 'èŠ±é˜ãƒ»è€åŸ', d: '2h' }, { t: '17:00', a: 'è¯åˆåœ‹è¬åœ‹å®®', d: '1h' },
          { t: '19:00', a: 'æ¹–ç•”æ™šé¤', d: '2h' }
        ], map: ['Interlaken Ost', 'Bern', 'Geneva Cornavin', 'Jet dEau Geneva'], route: 'å› ç‰¹æ‹‰è‚¯ ğŸš‚ â†’ Bern â†’ æ—¥å…§ç“¦ | Eva âœˆï¸ â†’ è‹±åœ‹' },
        { date: '2/18 (ä¸‰)', title: 'æ—¥å…§ç“¦è§€å…‰', icon: 'â›²', loc: 'æ—¥å…§ç“¦', fam: true, schedule: [
          { t: '09:00', a: 'æ—©é¤', d: '1h' }, { t: '10:00', a: 'æ—¥å…§ç“¦æ¹–éŠèˆ¹', d: '1.5h' },
          { t: '12:00', a: 'åˆé¤', d: '1h' }, { t: '13:30', a: 'è–å½¼å¾—å¤§æ•™å ‚', d: '1h' },
          { t: '15:00', a: 'ç´…åå­—æœƒåšç‰©é¤¨', d: '2h' }, { t: '17:00', a: 'è³¼ç‰©', d: '2h' },
          { t: '19:30', a: 'æ™šé¤', d: '2h' }
        ], map: ['Lake Geneva', 'St Pierre Cathedral Geneva', 'Red Cross Museum Geneva'], route: 'æ—¥å…§ç“¦å¸‚å€è§€å…‰' },
        { date: '2/19 (å››)', title: 'è¿”å›è˜‡é»ä¸–ãƒ»ğŸ‡©ğŸ‡ªå¾·åœ‹', icon: 'ğŸ›ï¸', loc: 'è˜‡é»ä¸–', fam: true, hl: true, schedule: [
          { t: '08:00', a: 'æ—©é¤ãƒ»é€€æˆ¿', d: '1h' }, { t: '09:30', a: 'ğŸš‚ æ—¥å…§ç“¦â†’è˜‡é»ä¸–', d: '2h45m' },
          { t: '12:15', a: 'æŠµé”è˜‡é»ä¸–', d: '-' }, { t: '12:30', a: 'å…¥ä½ãƒ»åˆé¤', d: '1.5h' },
          { t: '14:00', a: 'ğŸ‡©ğŸ‡ª ğŸš‚ è˜‡é»ä¸–â†’åº·æ–¯å¦èŒ¨', d: '1h15m' }, { t: '15:15', a: 'ğŸ›ï¸ dm è—¥å¦åº—', d: '1h' },
          { t: '16:15', a: 'ğŸ›ï¸ Rossmann', d: '45m' }, { t: '17:00', a: 'ğŸ›ï¸ MÃ¼ller ç™¾è²¨', d: '45m' },
          { t: '18:00', a: 'ğŸš‚ è¿”å›è˜‡é»ä¸–', d: '1h15m' }, { t: '19:30', a: 'æ™šé¤', d: '2h' }
        ], map: ['Geneva Cornavin', 'Zurich HB', 'Konstanz Station'], route: 'æ—¥å…§ç“¦ ğŸš‚ â†’ è˜‡é»ä¸– ğŸš‚ â†’ åº·æ–¯å¦èŒ¨ğŸ‡©ğŸ‡ª â†’ è˜‡é»ä¸–' },
        { date: '2/20 (äº”)', title: 'å®¶äººè¿”ç¨‹', icon: 'âœˆï¸', loc: 'é¦™æ¸¯', fam: true, schedule: [
          { t: '06:30', a: 'èµ·åºŠãƒ»æœ€å¾Œæ•´ç†', d: '30m' }, { t: '07:00', a: 'æ—©é¤ãƒ»é€€æˆ¿', d: '45m' },
          { t: '08:00', a: 'ğŸš‚ å‰å¾€è˜‡é»ä¸–æ©Ÿå ´', d: '15m' }, { t: '08:30', a: 'Check-in', d: '1h' },
          { t: '09:30', a: 'æ©Ÿå ´å…ç¨…åº—', d: '1.5h' }, { t: '11:55', a: 'âœˆï¸ CX382 èµ·é£›', d: '11h20m' },
          { t: '+1æ—¥', a: '06:15 æŠµé”é¦™æ¸¯', d: '-' }
        ], map: ['Zurich HB', 'Zurich Airport'], route: 'è˜‡é»ä¸– ğŸš‚ â†’ æ©Ÿå ´ âœˆï¸ â†’ é¦™æ¸¯' }
      ],
      glacier: {
        date: '2/12ï¼ˆå››ï¼‰08:38 - 17:07',
        booking: {
          confirmNo: '2759298-1',
          name: 'Wen-hung Yang',
          train: '903',
          class: 'é ­ç­‰è‰™ 1. Class',
          car: '24',
          seats: '21-22, 24-26',
          qty: '5äºº',
          meal: '2é“å¼åˆé¤(è‚‰) x5',
          mealPrice: 'CHF 210'
        },
        route: ['è–è«é‡ŒèŒ² 1,775m', 'ğŸŒ‰ è˜­å¾·ç“¦ç‘Ÿé«˜æ¶æ©‹', 'åº«çˆ¾ 585mï¼ˆæœ€ä½é»ï¼‰', 'ğŸ”ï¸ èŠèŒµå³½è°·', 'â›°ï¸ ä¸Šé˜¿çˆ¾å‘æ–¯å±±å£ 2,033mï¼ˆæœ€é«˜é»ï¼‰', 'å®‰å¾·é¦¬ç‰¹', 'é‡‡çˆ¾é¦¬ç‰¹ 1,604m ğŸ”ï¸'],
        tips: ['å³å´åº§ä½çœ‹é«˜æ¶æ©‹æœ€ä½³', 'è»Šä¸Šåªèƒ½ç„¡ç¾é‡‘æ”¯ä»˜', 'ææ—©åˆ°è»Šç«™æ‰¾åº§ä½']
      },
      budget: [
        { cat: 'transport', label: 'ğŸš‚ äº¤é€š', items: [
          { n: 'Eva è‹±åœ‹â†”ç‘å£«æ©Ÿç¥¨', c: 180, note: 'easyJet æˆ– SWISS' },
          { n: 'Swiss Travel Pass 8å¤© x5', c: 2245, note: 'CHF 449/äºº' },
          { n: 'å†°å·åˆ—è»Šè¨‚ä½è²» x5ï¼ˆé ­ç­‰ï¼‰', c: 345, note: 'CHF 69/äºº' },
          { n: 'å†°å·åˆ—è»Šåˆé¤ x5', c: 210, note: '2é“å¼(è‚‰)' },
          { n: 'å°‘å¥³å³°éµè·¯ x5 (75æŠ˜)', c: 850, note: 'Eiger Express' },
          { n: 'Gornergrat éµè·¯ x5 (50æŠ˜)', c: 450, note: '' },
          { n: 'å®¶äºº æ—¥å…§ç“¦â†’è˜‡é»ä¸–', c: 348, note: '4äºº' },
          { n: 'å®¶äºº å¾·åœ‹åº·æ–¯å¦èŒ¨ä¾†å›', c: 200, note: '4äºº' }
        ]},
        { cat: 'hotel', label: 'ğŸ¨ ä½å®¿', items: [
          { n: 'è˜‡é»ä¸– 4æ™š', c: 800, note: '2/7-2/10 + 2/19' },
          { n: 'è–è«é‡ŒèŒ² 1æ™š', c: 300, note: '2/11' },
          { n: 'é‡‡çˆ¾é¦¬ç‰¹ 3æ™š', c: 750, note: '2/12-2/14' },
          { n: 'å› ç‰¹æ‹‰è‚¯ 2æ™š', c: 400, note: '2/15-2/16' },
          { n: 'æ—¥å…§ç“¦ 2æ™š', c: 360, note: '2/17-2/18' }
        ]},
        { cat: 'activity', label: 'ğŸ« æ´»å‹•', items: [
          { n: 'åˆ—æ”¯æ•¦å£«ç™»è“‹ç« +å“é…’', c: 75, note: '5äºº' },
          { n: 'è–è«é‡ŒèŒ²çºœè»Š', c: 150, note: '5äºº' }
        ]}
      ],
      packing: {
        'ğŸ“„ è­‰ä»¶æ–‡ä»¶': ['è­·ç…§ x5', 'æ©Ÿç¥¨/é›»å­æ©Ÿç¥¨', 'Swiss Travel Pass x5', 'å†°å·åˆ—è»Šè¨‚ä½ç¢ºèª', 'é…’åº—é è¨‚ç¢ºèª', 'æ—…éŠä¿éšªæ–‡ä»¶', 'ä¿¡ç”¨å¡/ææ¬¾å¡', 'ç‘å£«æ³•éƒç¾é‡‘', 'è­‰ä»¶å½±æœ¬ï¼ˆå‚™ç”¨ï¼‰'],
        'ğŸ§¥ ä¿æš–è¡£ç‰©': ['ç¾½çµ¨å¤–å¥—', 'é˜²æ°´å¤–å¥—/é¢¨è¡£', 'ä¿æš–æ¯›è¡£ x3', 'ç™¼ç†±è¡£ x4', 'ç™¼ç†±è¤² x2', 'åœå·¾', 'æ¯›å¸½', 'æ‰‹å¥—', 'åšè¥ªå­ x4'],
        'ğŸ‘Ÿ é‹å­é…ä»¶': ['é˜²æ°´ç™»å±±é‹', 'å®¤å…§æ‹–é‹', 'å¤ªé™½çœ¼é¡ï¼ˆé›ªåœ°ç”¨ï¼‰', 'å¢¨é¡å¤¾ç‰‡'],
        'ğŸ§´ ç›¥æ´—ç”¨å“': ['ç‰™åˆ·ç‰™è†', 'æ´—é¢ä¹³', 'ä¿æ¿•ä¹³æ¶²', 'è­·å”‡è†', 'é˜²æ›¬ä¹³', 'æ´—é«®ç²¾/æ²æµ´ä¹³', 'æ¯›å·¾', 'æ¢³å­'],
        'ğŸ’Š é†«è—¥ç”¨å“': ['å€‹äººè—¥å“', 'æ„Ÿå†’è—¥', 'è…¸èƒƒè—¥', 'æ­¢ç—›è—¥', 'OKç¹ƒ', 'æšˆè»Šè—¥'],
        'ğŸ“± é›»å­ç”¢å“': ['æ‰‹æ©Ÿ+å……é›»ç·š', 'è¡Œå‹•é›»æº', 'ç›¸æ©Ÿ+è¨˜æ†¶å¡', 'æ­è¦è½‰æ¥é ­', 'è€³æ©Ÿ'],
        'ğŸ’ å…¶ä»–': ['è¡Œæç®±', 'éš¨èº«èƒŒåŒ…', 'é ¸æ•', 'çœ¼ç½©è€³å¡', 'é›¨å‚˜', 'è³¼ç‰©è¢‹', 'é›¶é£Ÿ', 'ä¿æº«ç“¶']
      },
      fileCategories: ['Swiss Pass', 'å†°å·åˆ—è»Š', 'é…’åº—ç¢ºèª', 'æ©Ÿç¥¨', 'å…¶ä»–']
    };

    const FILE_PASSWORD = '558894';

    let state = {
      rate: 36,
      budget: JSON.parse(localStorage.getItem('swissBudget3')) || JSON.parse(JSON.stringify(DEFAULT_DATA.budget)),
      packing: JSON.parse(localStorage.getItem('swissPacking3')) || JSON.parse(JSON.stringify(DEFAULT_DATA.packing)),
      checked: JSON.parse(localStorage.getItem('swissChecked3')) || {},
      files: JSON.parse(localStorage.getItem('swissFiles')) || [],
      fileCategories: JSON.parse(localStorage.getItem('swissFileCats')) || [...DEFAULT_DATA.fileCategories],
      filesUnlocked: false,
      openDays: {}
    };

    function save() {
      localStorage.setItem('swissBudget3', JSON.stringify(state.budget));
      localStorage.setItem('swissPacking3', JSON.stringify(state.packing));
      localStorage.setItem('swissChecked3', JSON.stringify(state.checked));
      localStorage.setItem('swissFiles', JSON.stringify(state.files));
      localStorage.setItem('swissFileCats', JSON.stringify(state.fileCategories));
      localStorage.setItem('swissRate3', state.rate);
    }

    const savedRate = localStorage.getItem('swissRate3');
    if (savedRate) state.rate = parseFloat(savedRate);

    function genMapUrl(points) {
      if (!points || points.length === 0) return '';
      if (points.length === 1) return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(points[0])}`;
      const o = encodeURIComponent(points[0]), d = encodeURIComponent(points[points.length - 1]);
      const w = points.slice(1, -1).map(p => encodeURIComponent(p)).join('|');
      return `https://www.google.com/maps/dir/?api=1&origin=${o}&destination=${d}${w ? `&waypoints=${w}` : ''}&travelmode=transit`;
    }

    function openModal(title, bodyHtml) {
      document.getElementById('modal-title').textContent = title;
      document.getElementById('modal-body').innerHTML = bodyHtml;
      document.getElementById('modal').classList.remove('hidden');
    }

    function closeModal() { document.getElementById('modal').classList.add('hidden'); }

    // Itinerary
    function renderItinerary() {
      const el = document.getElementById('itinerary-tab');
      el.innerHTML = '<p style="font-size:0.875rem;color:#6b7280;margin-bottom:12px;">ğŸ“ é»æ“Šå±•é–‹æŸ¥çœ‹è©³ç´°è¡Œç¨‹</p>' +
        DEFAULT_DATA.itinerary.map((day, i) => `
          <div class="card ${day.hl ? 'highlight' : ''} ${day.fam ? 'family' : ''}">
            <button class="day-header" onclick="toggleDay(${i})">
              <div class="day-left">
                <span class="day-icon">${day.icon}</span>
                <div>
                  <div class="day-date">${day.date}</div>
                  <div class="day-title">${day.title}</div>
                  <div class="day-loc">ğŸ“ ${day.loc}</div>
                </div>
              </div>
              <div class="day-right">
                ${day.first ? '<span class="badge badge-first">é ­ç­‰è‰™</span>' : ''}
                ${day.fam ? '<span class="badge badge-family">å®¶äºº</span>' : ''}
                ${day.hl ? '<span class="badge badge-highlight">é‡é»</span>' : ''}
                <span class="arrow" id="arrow-${i}">â–¼</span>
              </div>
            </button>
            <div class="day-content" id="content-${i}">
              ${day.route ? `<div class="route-section"><h4>ğŸš‚ äº¤é€šè·¯ç·š</h4><div style="font-size:0.875rem;color:#374151;">${day.route}</div></div>` : ''}
              ${day.booking ? `
                <div class="booking-info">
                  <div><strong>ğŸ« è¨‚ä½ç¢ºèª</strong></div>
                  <div>åˆ—è»Š ${day.booking.train} ï½œè»Šå»‚ ${day.booking.car} ï½œåº§ä½ ${day.booking.seats}</div>
                  <div>${day.booking.class} ï½œ${day.booking.meal}</div>
                </div>
              ` : ''}
              <div class="hotel-box">ğŸ¨ ä½å®¿ï¼šå¾…è¨‚</div>
              <div class="schedule">
                ${day.schedule.map(s => `
                  <div class="schedule-item">
                    <span class="schedule-time">${s.t}</span>
                    <div>
                      <div class="schedule-activity">${s.a}</div>
                      ${s.d !== '-' ? `<div class="schedule-duration">â± ${s.d}</div>` : ''}
                    </div>
                  </div>
                `).join('')}
              </div>
              ${day.map?.length ? `<a class="map-btn" href="${genMapUrl(day.map)}" target="_blank">ğŸ—ºï¸ é–‹å•Ÿ Google Maps å°èˆª</a>` : ''}
            </div>
          </div>
        `).join('');
    }

    function toggleDay(i) {
      state.openDays[i] = !state.openDays[i];
      document.getElementById(`content-${i}`).classList.toggle('open', state.openDays[i]);
      document.getElementById(`arrow-${i}`).textContent = state.openDays[i] ? 'â–²' : 'â–¼';
    }

    // Glacier
    function renderGlacier() {
      const g = DEFAULT_DATA.glacier;
      const b = g.booking;
      const el = document.getElementById('glacier-tab');
      el.innerHTML = `
        <div class="card" style="padding:16px;">
          <div class="section-title">ğŸš‚ å†°å·åˆ—è»Š Glacier Express</div>
          <p style="font-size:0.875rem;color:#4b5563;margin-bottom:8px;">${g.date}</p>
          <p style="font-size:0.875rem;color:#4b5563;">è–è«é‡ŒèŒ² â†’ é‡‡çˆ¾é¦¬ç‰¹ï½œ8å°æ™‚29åˆ†</p>
        </div>
        <div class="card" style="padding:16px;">
          <div class="section-title">ğŸ« è¨‚ä½è³‡è¨Š</div>
          <div style="background:#dbeafe;padding:16px;border-radius:12px;font-size:0.875rem;">
            <div style="margin-bottom:8px;"><strong>ç¢ºèªç·¨è™Ÿï¼š</strong>${b.confirmNo}</div>
            <div style="margin-bottom:8px;"><strong>è¨‚ä½äººï¼š</strong>${b.name}</div>
            <div style="margin-bottom:8px;"><strong>åˆ—è»Šï¼š</strong>${b.train}</div>
            <div style="margin-bottom:8px;"><strong>è‰™ç­‰ï¼š</strong>${b.class}</div>
            <div style="margin-bottom:8px;"><strong>è»Šå»‚ï¼š</strong>${b.car}è™Ÿ</div>
            <div style="margin-bottom:8px;"><strong>åº§ä½ï¼š</strong>${b.seats}</div>
            <div style="margin-bottom:8px;"><strong>äººæ•¸ï¼š</strong>${b.qty}</div>
            <div style="margin-bottom:8px;"><strong>é¤é»ï¼š</strong>${b.meal}</div>
            <div><strong>é¤è²»ï¼š</strong>${b.mealPrice}</div>
          </div>
          <div class="info-box" style="margin-top:12px;">
            âš ï¸ æ­¤ç¢ºèªä¸å«è»Šç¥¨ï¼Œéœ€å¦å¤–å‡ºç¤ºæœ‰æ•ˆè»Šç¥¨ï¼ˆSwiss Travel Passï¼‰
          </div>
        </div>
        <div class="card" style="padding:16px;">
          <div class="section-title">ğŸ”ï¸ è·¯ç·šäº®é»</div>
          ${g.route.map(r => `<div class="route-item"><div class="route-dot"></div><span>${r}</span></div>`).join('')}
        </div>
        <div class="tip-box">
          <h3>ğŸ’¡ å°æé†’</h3>
          <ul>${g.tips.map(t => `<li>${t}</li>`).join('')}</ul>
        </div>
      `;
    }

    // Budget
    function renderBudget() {
      const total = state.budget.reduce((s, g) => s + g.items.reduce((ss, i) => ss + i.c, 0), 0);
      const el = document.getElementById('budget-tab');
      el.innerHTML = `
        <div class="card" style="padding:16px;">
          <div class="budget-header">
            <h2 style="font-weight:600;font-size:1.125rem;">ğŸ’° é ç®—ç¸½è¦½ï¼ˆ5äººï¼‰</h2>
            <div class="rate-badge" onclick="editRate()">
              âš™ï¸ 1 CHF = ${state.rate} TWD
            </div>
          </div>
          ${state.budget.map((g, gi) => `
            <div class="budget-cat">${g.label}</div>
            ${g.items.map((item, ii) => `
              <div class="budget-row">
                <div class="budget-item">
                  <div class="budget-item-name">${item.n}</div>
                  ${item.note ? `<div class="budget-item-note">ğŸ’¬ ${item.note}</div>` : ''}
                </div>
                <span class="budget-chf">CHF ${item.c}</span>
                <span class="budget-twd">â‰ˆ NT$${Math.round(item.c * state.rate).toLocaleString()}</span>
                <div class="budget-actions">
                  <button class="btn-icon edit" onclick="editBudgetItem(${gi}, ${ii})">âœï¸</button>
                  <button class="btn-icon delete" onclick="deleteBudgetItem(${gi}, ${ii})">ğŸ—‘ï¸</button>
                </div>
              </div>
            `).join('')}
          `).join('')}
          <div class="budget-total">
            <span class="budget-total-label">é ä¼°ç¸½è¨ˆ</span>
            <div class="budget-total-value">
              <div class="budget-total-chf">CHF ${total.toLocaleString()}</div>
              <div class="budget-total-twd">â‰ˆ NT$ ${Math.round(total * state.rate).toLocaleString()}</div>
            </div>
          </div>
        </div>
        <button class="add-btn" onclick="addBudgetItem()">â• æ–°å¢é ç®—é …ç›®</button>
        <div class="info-box">ğŸ’¡ ä¸å«é¤è²»ï¼ˆç´„ CHF 50-80/å¤©/äººï¼‰åŠè³¼ç‰©</div>
      `;
    }

    function editRate() {
      openModal('âš™ï¸ è¨­å®šåŒ¯ç‡', `
        <div class="form-group">
          <label class="form-label">1 CHF = ? TWD</label>
          <input type="number" id="rate-input" class="form-input" value="${state.rate}" step="0.1">
        </div>
        <button class="form-btn primary" onclick="saveRate()">å„²å­˜</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
    }

    function saveRate() {
      const val = parseFloat(document.getElementById('rate-input').value);
      if (val > 0) { state.rate = val; save(); renderBudget(); closeModal(); }
    }

    function addBudgetItem() {
      openModal('â• æ–°å¢é ç®—é …ç›®', `
        <div class="form-group">
          <label class="form-label">é¡åˆ¥</label>
          <select id="budget-cat" class="form-select">
            ${state.budget.map((g, i) => `<option value="${i}">${g.label}</option>`).join('')}
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">é …ç›®åç¨±</label>
          <input type="text" id="budget-name" class="form-input" placeholder="ä¾‹ï¼šç´€å¿µå“">
        </div>
        <div class="form-group">
          <label class="form-label">é‡‘é¡ (CHF)</label>
          <input type="number" id="budget-amount" class="form-input" placeholder="50">
          <div class="form-hint" id="budget-twd-hint"></div>
        </div>
        <div class="form-group">
          <label class="form-label">å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
          <input type="text" id="budget-note" class="form-input">
        </div>
        <button class="form-btn primary" onclick="saveBudgetItem()">ç¢ºèªæ–°å¢</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
      document.getElementById('budget-amount').addEventListener('input', function() {
        const val = parseFloat(this.value) || 0;
        document.getElementById('budget-twd-hint').textContent = val ? `â‰ˆ NT$ ${Math.round(val * state.rate).toLocaleString()}` : '';
      });
    }

    function saveBudgetItem() {
      const cat = parseInt(document.getElementById('budget-cat').value);
      const name = document.getElementById('budget-name').value.trim();
      const amount = parseFloat(document.getElementById('budget-amount').value);
      const note = document.getElementById('budget-note').value.trim();
      if (!name || !amount) return alert('è«‹å¡«å¯«åç¨±å’Œé‡‘é¡');
      state.budget[cat].items.push({ n: name, c: amount, note });
      save(); renderBudget(); closeModal();
    }

    function editBudgetItem(gi, ii) {
      const item = state.budget[gi].items[ii];
      openModal('âœï¸ ç·¨è¼¯é …ç›®', `
        <div class="form-group">
          <label class="form-label">é¡åˆ¥</label>
          <select id="budget-cat" class="form-select">
            ${state.budget.map((g, i) => `<option value="${i}" ${i === gi ? 'selected' : ''}>${g.label}</option>`).join('')}
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">é …ç›®åç¨±</label>
          <input type="text" id="budget-name" class="form-input" value="${item.n}">
        </div>
        <div class="form-group">
          <label class="form-label">é‡‘é¡ (CHF)</label>
          <input type="number" id="budget-amount" class="form-input" value="${item.c}">
          <div class="form-hint" id="budget-twd-hint">â‰ˆ NT$ ${Math.round(item.c * state.rate).toLocaleString()}</div>
        </div>
        <div class="form-group">
          <label class="form-label">å‚™è¨»</label>
          <input type="text" id="budget-note" class="form-input" value="${item.note || ''}">
        </div>
        <button class="form-btn primary" onclick="updateBudgetItem(${gi}, ${ii})">å„²å­˜</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
      document.getElementById('budget-amount').addEventListener('input', function() {
        const val = parseFloat(this.value) || 0;
        document.getElementById('budget-twd-hint').textContent = val ? `â‰ˆ NT$ ${Math.round(val * state.rate).toLocaleString()}` : '';
      });
    }

    function updateBudgetItem(oldGi, ii) {
      const newGi = parseInt(document.getElementById('budget-cat').value);
      const name = document.getElementById('budget-name').value.trim();
      const amount = parseFloat(document.getElementById('budget-amount').value);
      const note = document.getElementById('budget-note').value.trim();
      if (!name || !amount) return alert('è«‹å¡«å¯«åç¨±å’Œé‡‘é¡');
      state.budget[oldGi].items.splice(ii, 1);
      state.budget[newGi].items.push({ n: name, c: amount, note });
      save(); renderBudget(); closeModal();
    }

    function deleteBudgetItem(gi, ii) {
      if (confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) { state.budget[gi].items.splice(ii, 1); save(); renderBudget(); }
    }

    // Packing
    function renderPacking() {
      const all = Object.values(state.packing).flat();
      const done = all.filter(i => state.checked[i]).length;
      const el = document.getElementById('packing-tab');
      el.innerHTML = `
        <div class="packing-header">
          <div class="packing-title">
            <h2 style="font-weight:600;font-size:1.125rem;">ğŸ§³ æ‰“åŒ…æ¸…å–®</h2>
            <div style="text-align:right;">
              <span class="packing-count ${done === all.length ? 'done' : 'pending'}">${done}/${all.length}</span>
              <div class="packing-subtitle">${done === all.length ? 'âœ… å®Œæˆï¼' : 'ç¹¼çºŒåŠ æ²¹'}</div>
            </div>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:${all.length ? (done/all.length)*100 : 0}%"></div></div>
        </div>
        <div class="packing-btns">
          <button class="add-btn" onclick="addPackingItem()">â• æ–°å¢ç‰©å“</button>
          <button class="add-btn purple" onclick="addPackingCategory()">ğŸ“ æ–°å¢åˆ†é¡</button>
        </div>
        ${Object.entries(state.packing).map(([cat, items]) => {
          const catDone = items.filter(i => state.checked[i]).length;
          return `
            <div class="card" style="padding:16px;">
              <div class="cat-header">
                <span class="cat-title">${cat}</span>
                <div class="cat-actions">
                  <span class="cat-count ${catDone === items.length && items.length ? 'done' : ''}">${catDone}/${items.length}</span>
                  <button class="btn-icon delete" onclick="deletePackingCategory('${cat.replace(/'/g, "\\'")}')">ğŸ—‘ï¸</button>
                </div>
              </div>
              ${items.length ? items.map((item, idx) => `
                <div class="check-item ${state.checked[item] ? 'checked' : ''}" onclick="toggleCheck('${item.replace(/'/g, "\\'")}')">
                  <div class="checkbox">${state.checked[item] ? 'âœ“' : ''}</div>
                  <span class="check-label">${item}</span>
                  <div class="check-actions" onclick="event.stopPropagation()">
                    <button class="btn-icon edit" onclick="editPackingItem('${cat.replace(/'/g, "\\'")}', ${idx})">âœï¸</button>
                    <button class="btn-icon delete" onclick="deletePackingItem('${cat.replace(/'/g, "\\'")}', ${idx})">ğŸ—‘ï¸</button>
                  </div>
                </div>
              `).join('') : '<p style="font-size:0.875rem;color:#9ca3af;text-align:center;padding:12px;">å°šç„¡ç‰©å“</p>'}
            </div>
          `;
        }).join('')}
        <button class="reset-btn" onclick="resetChecked()">ğŸ”„ é‡ç½®å…¨éƒ¨å‹¾é¸</button>
      `;
    }

    function toggleCheck(item) { state.checked[item] = !state.checked[item]; save(); renderPacking(); }
    function resetChecked() { if (confirm('ç¢ºå®šé‡ç½®ï¼Ÿ')) { state.checked = {}; save(); renderPacking(); } }

    function addPackingItem() {
      openModal('â• æ–°å¢ç‰©å“', `
        <div class="form-group">
          <label class="form-label">åˆ†é¡</label>
          <select id="packing-cat" class="form-select">
            ${Object.keys(state.packing).map(c => `<option value="${c}">${c}</option>`).join('')}
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">ç‰©å“åç¨±</label>
          <input type="text" id="packing-name" class="form-input">
        </div>
        <button class="form-btn primary" onclick="savePackingItem()">ç¢ºèª</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
    }

    function savePackingItem() {
      const cat = document.getElementById('packing-cat').value;
      const name = document.getElementById('packing-name').value.trim();
      if (!name) return alert('è«‹å¡«å¯«ç‰©å“åç¨±');
      state.packing[cat].push(name); save(); renderPacking(); closeModal();
    }

    function editPackingItem(cat, idx) {
      const item = state.packing[cat][idx];
      openModal('âœï¸ ç·¨è¼¯ç‰©å“', `
        <div class="form-group">
          <label class="form-label">ç‰©å“åç¨±</label>
          <input type="text" id="packing-name" class="form-input" value="${item}">
        </div>
        <button class="form-btn primary" onclick="updatePackingItem('${cat.replace(/'/g, "\\'")}', ${idx})">å„²å­˜</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
    }

    function updatePackingItem(cat, idx) {
      const oldName = state.packing[cat][idx];
      const newName = document.getElementById('packing-name').value.trim();
      if (!newName) return alert('è«‹å¡«å¯«ç‰©å“åç¨±');
      state.packing[cat][idx] = newName;
      if (state.checked[oldName]) { delete state.checked[oldName]; state.checked[newName] = true; }
      save(); renderPacking(); closeModal();
    }

    function deletePackingItem(cat, idx) {
      if (confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) {
        delete state.checked[state.packing[cat][idx]];
        state.packing[cat].splice(idx, 1); save(); renderPacking();
      }
    }

    function addPackingCategory() {
      openModal('ğŸ“ æ–°å¢åˆ†é¡', `
        <div class="form-group">
          <label class="form-label">åˆ†é¡åç¨±</label>
          <input type="text" id="cat-name" class="form-input" placeholder="ğŸ ä¼´æ‰‹ç¦®">
        </div>
        <button class="form-btn primary" onclick="savePackingCategory()">ç¢ºèª</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
    }

    function savePackingCategory() {
      let name = document.getElementById('cat-name').value.trim();
      if (!name) return alert('è«‹å¡«å¯«åˆ†é¡åç¨±');
      if (!name.match(/^[\u{1F300}-\u{1F9FF}]/u)) name = 'ğŸ’ ' + name;
      if (state.packing[name]) return alert('æ­¤åˆ†é¡å·²å­˜åœ¨');
      state.packing[name] = []; save(); renderPacking(); closeModal();
    }

    function deletePackingCategory(cat) {
      if (confirm(`ç¢ºå®šåˆªé™¤ã€Œ${cat}ã€ï¼Ÿ`)) {
        state.packing[cat].forEach(item => delete state.checked[item]);
        delete state.packing[cat]; save(); renderPacking();
      }
    }

    // Files
    function renderFiles() {
      const el = document.getElementById('files-tab');
      if (!state.filesUnlocked) {
        el.innerHTML = `
          <div class="lock-screen">
            <div class="lock-icon">ğŸ”’</div>
            <div class="lock-title">æ–‡ä»¶å·²åŠ å¯†</div>
            <div class="lock-desc">è«‹è¼¸å…¥å¯†ç¢¼æŸ¥çœ‹æ–‡ä»¶</div>
            <input type="password" id="file-password" class="password-input" maxlength="6" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
            <br>
            <button class="unlock-btn" onclick="unlockFiles()">ğŸ”“ è§£é–</button>
            <div id="password-error" class="error-msg hidden"></div>
          </div>
        `;
        setTimeout(() => {
          const input = document.getElementById('file-password');
          if (input) {
            input.addEventListener('keypress', e => { if (e.key === 'Enter') unlockFiles(); });
          }
        }, 100);
        return;
      }

      const grouped = {};
      state.fileCategories.forEach(cat => grouped[cat] = []);
      state.files.forEach(f => {
        if (!grouped[f.category]) grouped[f.category] = [];
        grouped[f.category].push(f);
      });

      el.innerHTML = `
        <div class="upload-zone" id="upload-zone" onclick="document.getElementById('file-input').click()">
          <div class="upload-icon">ğŸ“¤</div>
          <div class="upload-text">é»æ“Šæˆ–æ‹–æ›³æª”æ¡ˆä¸Šå‚³</div>
          <div class="upload-hint">æ”¯æ´ PDF, JPG, PNGï¼ˆå–®æª”æœ€å¤§ 5MBï¼‰</div>
          <input type="file" id="file-input" accept=".pdf,.jpg,.jpeg,.png" multiple style="display:none" onchange="handleFileUpload(event)">
        </div>
        <div class="packing-btns">
          <button class="add-btn purple" onclick="addFileCategory()">ğŸ“ æ–°å¢åˆ†é¡</button>
          <button class="add-btn" style="background:#ef4444;" onclick="lockFiles()">ğŸ”’ é–å®š</button>
        </div>
        ${state.fileCategories.map(cat => `
          <div class="file-category">
            <div class="file-cat-header">
              <span class="file-cat-name">ğŸ“ ${cat}</span>
              <div class="cat-actions">
                <span class="file-cat-count">${grouped[cat]?.length || 0} å€‹æª”æ¡ˆ</span>
                <button class="btn-icon delete" onclick="deleteFileCategory('${cat.replace(/'/g, "\\'")}')">ğŸ—‘ï¸</button>
              </div>
            </div>
            ${grouped[cat]?.length ? grouped[cat].map((f, idx) => `
              <div class="file-item">
                <span class="file-icon">${f.type === 'application/pdf' ? 'ğŸ“„' : 'ğŸ–¼ï¸'}</span>
                <div class="file-info">
                  <div class="file-name">${f.name}</div>
                  <div class="file-meta">${formatFileSize(f.size)} ï½œ ${f.uploadDate}</div>
                </div>
                <div class="file-actions">
                  <button class="btn-icon" onclick="viewFile(${state.files.indexOf(f)})" title="æª¢è¦–">ğŸ‘ï¸</button>
                  <button class="btn-icon edit" onclick="editFile(${state.files.indexOf(f)})" title="ç·¨è¼¯">âœï¸</button>
                  <button class="btn-icon delete" onclick="deleteFile(${state.files.indexOf(f)})" title="åˆªé™¤">ğŸ—‘ï¸</button>
                </div>
              </div>
            `).join('') : '<p style="font-size:0.875rem;color:#9ca3af;text-align:center;padding:12px;">å°šç„¡æª”æ¡ˆ</p>'}
          </div>
        `).join('')}
        <div class="info-box">ğŸ’¡ æª”æ¡ˆå„²å­˜åœ¨ç€è¦½å™¨ä¸­ï¼Œæ¸…é™¤ç€è¦½è³‡æ–™æœƒéºå¤±æª”æ¡ˆ</div>
      `;

      // Drag and drop
      setTimeout(() => {
        const zone = document.getElementById('upload-zone');
        if (zone) {
          zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('dragover'); });
          zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
          zone.addEventListener('drop', e => { e.preventDefault(); zone.classList.remove('dragover'); handleFileDrop(e); });
        }
      }, 100);
    }

    function unlockFiles() {
      const input = document.getElementById('file-password');
      const error = document.getElementById('password-error');
      if (input.value === FILE_PASSWORD) {
        state.filesUnlocked = true;
        renderFiles();
      } else {
        error.textContent = 'å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡è©¦';
        error.classList.remove('hidden');
        input.value = '';
        input.focus();
      }
    }

    function lockFiles() {
      state.filesUnlocked = false;
      renderFiles();
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    function handleFileUpload(event) {
      const files = event.target.files;
      processFiles(files);
    }

    function handleFileDrop(event) {
      const files = event.dataTransfer.files;
      processFiles(files);
    }

    function processFiles(files) {
      Array.from(files).forEach(file => {
        if (file.size > 5 * 1024 * 1024) {
          alert(`${file.name} è¶…é 5MB é™åˆ¶`);
          return;
        }
        const reader = new FileReader();
        reader.onload = e => {
          openModal('ğŸ“¤ ä¸Šå‚³æª”æ¡ˆ', `
            <div class="form-group">
              <label class="form-label">æª”æ¡ˆåç¨±</label>
              <input type="text" id="file-name" class="form-input" value="${file.name}">
            </div>
            <div class="form-group">
              <label class="form-label">åˆ†é¡</label>
              <select id="file-category" class="form-select">
                ${state.fileCategories.map(c => `<option value="${c}">${c}</option>`).join('')}
              </select>
            </div>
            <div class="form-hint">æª”æ¡ˆå¤§å°ï¼š${formatFileSize(file.size)}</div>
            <button class="form-btn primary" onclick="saveFile('${e.target.result.replace(/'/g, "\\'")}', '${file.type}', ${file.size})">ç¢ºèªä¸Šå‚³</button>
            <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
          `);
        };
        reader.readAsDataURL(file);
      });
    }

    function saveFile(data, type, size) {
      const name = document.getElementById('file-name').value.trim();
      const category = document.getElementById('file-category').value;
      if (!name) return alert('è«‹å¡«å¯«æª”æ¡ˆåç¨±');
      state.files.push({
        name, category, type, size, data,
        uploadDate: new Date().toLocaleDateString('zh-TW')
      });
      save(); renderFiles(); closeModal();
    }

    function viewFile(idx) {
      const f = state.files[idx];
      if (f.type === 'application/pdf') {
        const win = window.open();
        win.document.write(`<iframe src="${f.data}" style="width:100%;height:100%;border:none;"></iframe>`);
      } else {
        const win = window.open();
        win.document.write(`<img src="${f.data}" style="max-width:100%;height:auto;">`);
      }
    }

    function editFile(idx) {
      const f = state.files[idx];
      openModal('âœï¸ ç·¨è¼¯æª”æ¡ˆ', `
        <div class="form-group">
          <label class="form-label">æª”æ¡ˆåç¨±</label>
          <input type="text" id="file-name" class="form-input" value="${f.name}">
        </div>
        <div class="form-group">
          <label class="form-label">åˆ†é¡</label>
          <select id="file-category" class="form-select">
            ${state.fileCategories.map(c => `<option value="${c}" ${c === f.category ? 'selected' : ''}>${c}</option>`).join('')}
          </select>
        </div>
        <button class="form-btn primary" onclick="updateFile(${idx})">å„²å­˜</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
    }

    function updateFile(idx) {
      state.files[idx].name = document.getElementById('file-name').value.trim();
      state.files[idx].category = document.getElementById('file-category').value;
      save(); renderFiles(); closeModal();
    }

    function deleteFile(idx) {
      if (confirm('ç¢ºå®šåˆªé™¤æ­¤æª”æ¡ˆï¼Ÿ')) {
        state.files.splice(idx, 1); save(); renderFiles();
      }
    }

    function addFileCategory() {
      openModal('ğŸ“ æ–°å¢åˆ†é¡', `
        <div class="form-group">
          <label class="form-label">åˆ†é¡åç¨±</label>
          <input type="text" id="cat-name" class="form-input" placeholder="ä¾‹ï¼šä¿éšªæ–‡ä»¶">
        </div>
        <button class="form-btn primary" onclick="saveFileCategory()">ç¢ºèª</button>
        <button class="form-btn secondary" onclick="closeModal()">å–æ¶ˆ</button>
      `);
    }

    function saveFileCategory() {
      const name = document.getElementById('cat-name').value.trim();
      if (!name) return alert('è«‹å¡«å¯«åˆ†é¡åç¨±');
      if (state.fileCategories.includes(name)) return alert('æ­¤åˆ†é¡å·²å­˜åœ¨');
      state.fileCategories.push(name); save(); renderFiles(); closeModal();
    }

    function deleteFileCategory(cat) {
      const hasFiles = state.files.some(f => f.category === cat);
      if (hasFiles) {
        if (!confirm(`ã€Œ${cat}ã€åˆ†é¡å…§æœ‰æª”æ¡ˆï¼Œåˆªé™¤åˆ†é¡æœƒå°‡æª”æ¡ˆç§»è‡³ã€Œå…¶ä»–ã€ï¼Ÿ`)) return;
        state.files.forEach(f => { if (f.category === cat) f.category = 'å…¶ä»–'; });
      }
      state.fileCategories = state.fileCategories.filter(c => c !== cat);
      save(); renderFiles();
    }

    // Tab switching
    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
      ['itinerary', 'glacier', 'budget', 'packing', 'files'].forEach(id => {
        document.getElementById(`${id}-tab`).classList.toggle('hidden', id !== tabId);
      });
      if (tabId === 'files') renderFiles();
    }

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => switchTab(tab.dataset.tab));
    });

    document.getElementById('modal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });

    // Init
    renderItinerary();
    renderGlacier();
    renderBudget();
    renderPacking();
    renderFiles();
  </script>
</body>
</html>